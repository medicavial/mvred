!function(){"use strict";angular.module("app",["ui.router","ngMaterial","ngMdIcons","webStorageModule","ngMessages","ngResource","ngAnimate","md.data.table","ngFileUpload","angular.filter","mdPickers","material.components.expansionPanels","vjs.video","amChartsDirective"]).constant("api","http://api.medicavial.net/api/").constant("publicfiles","http://api.medicavial.net/exports/")}(),function(){"use strict";function config($stateProvider,$urlRouterProvider,$locationProvider,$mdThemingProvider,$httpProvider,$compileProvider,$mdDateLocaleProvider,$sceDelegateProvider){$compileProvider.debugInfoEnabled(!0),$sceDelegateProvider.resourceUrlWhitelist(["self","http://medicavial.net/**"]),$mdDateLocaleProvider.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],$mdDateLocaleProvider.shortMonths=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],$mdDateLocaleProvider.days=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],$mdDateLocaleProvider.shortDays=["Do","Lu","Ma","Mi","Ju","Vi","Sa"],moment.locale("es"),$mdDateLocaleProvider.formatDate=function(date){return date?moment(date).format("DD/MM/YYYY"):""},$mdDateLocaleProvider.parseDate=function(dateString){var m=moment(dateString,"DD/MM/YYYY",!0);return m.isValid()?m.toDate():new Date(NaN)},$urlRouterProvider.otherwise("/home"),$stateProvider.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl",controllerAs:"sesion"}).state("index",{url:"/","abstract":!0,templateUrl:"views/base.html"}).state("index.ayuda",{url:"ayuda",templateUrl:"views/ayuda.html",controller:"ayudaCtrl",controllerAs:"au"}).state("index.busqueda",{url:"busqueda",templateUrl:"views/busqueda.html",controller:"busquedaCtrl",controllerAs:"bs"}).state("index.busquedaGeneral",{url:"busquedaGeneral",templateUrl:"views/busqueda.html",controller:"busquedaGeneralCtrl",controllerAs:"bs"}).state("index.estadisticas",{url:"estadisticas",templateUrl:"views/estadisticas.html",controller:"estadisticasCtrl",controllerAs:"et",resolve:{datos:function(reportes,$q){var promesa=$q.defer(),atencionesMes=reportes.atencionesMes(),atencionesAnio=reportes.atencionesAnio();return $q.all([atencionesMes,atencionesAnio]).then(function(data){promesa.resolve(data)},function(error){promesa.reject("Error")}),promesa.promise}}}).state("index.formatos",{url:"formatos",templateUrl:"views/formatos.html",controller:"formatosCtrl",controllerAs:"fr"}).state("index.home",{url:"home",templateUrl:"views/home.html",controller:"homeCtrl",controllerAs:"hm"}).state("index.registro",{url:"registro",templateUrl:"views/registro.html",controller:"registroCtrl",controllerAs:"rg",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),clientes=busqueda.clientes();return $q.all([clientes]).then(function(data){var datos={clientes:data[0].data};promesa.resolve(datos)},function(error){promesa.reject("error en consulta")}),promesa.promise}}}).state("index.detalle",{url:"detalle?folio",templateUrl:"views/detalle.html",controller:"detalleCtrl",controllerAs:"dt",resolve:{datos:function(busqueda,$stateParams){return busqueda.detalleFolio($stateParams.folio)}},reload:!0}),$locationProvider.html5Mode(!0),$mdThemingProvider.theme("theme1").primaryPalette("indigo").accentPalette("red"),$mdThemingProvider.theme("theme2").primaryPalette("deep-orange").warnPalette("indigo").accentPalette("red"),$mdThemingProvider.theme("theme3").primaryPalette("neonBlue").accentPalette("red"),$mdThemingProvider.theme("theme4").primaryPalette("blue-grey").accentPalette("red"),$mdThemingProvider.theme("theme5").primaryPalette("neonGreen").accentPalette("red"),$mdThemingProvider.theme("theme6").primaryPalette("deep-purple").accentPalette("red"),$mdThemingProvider.theme("docs-dark").primaryPalette("red").dark();var neonBlueMap=$mdThemingProvider.extendPalette("blue",{500:"#3175E7",contrastDefaultColor:"light"}),neonGreenMap=$mdThemingProvider.extendPalette("green",{500:"#259B24",contrastDefaultColor:"light"});$mdThemingProvider.definePalette("neonBlue",neonBlueMap),$mdThemingProvider.definePalette("neonGreen",neonGreenMap),$mdThemingProvider.setDefaultTheme("theme1"),$mdThemingProvider.alwaysWatchTheme(!0),$httpProvider.defaults.timeout=1e3}angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider","$httpProvider","$compileProvider","$mdDateLocaleProvider","$sceDelegateProvider"]}(),function(){"use strict";function run($rootScope,$state,$mdSidenav,$mdBottomSheet,auth,webStorage,$window,api,$mdMedia,mensajes){$rootScope.atras=!1,$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),$rootScope.localidad=webStorage.session.get("localidad"),$rootScope.unidad=webStorage.session.get("unidad"),$rootScope.nombreUni=webStorage.session.get("nombreUni"),$rootScope.permisos=JSON.parse(webStorage.session.get("permisos")),$rootScope.muestra=function(ruta){$state.go(ruta)},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$rootScope.atras=!1,$rootScope.url=toState.name,"login"!==$rootScope.url&&null===webStorage.session.get("username")&&(event.preventDefault(),$state.go("login")),"login"===$rootScope.url&&null!==webStorage.session.get("username")&&(event.preventDefault(),$state.go("index.home")),$rootScope.cargando=!0}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$rootScope.cargando=!1,$rootScope.menu="menu"}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){$rootScope.cargando=!1,mensajes.alerta("Problemas de conexión intentalo nuevamente por favor","error","top right","error"),event.preventDefault(),$state.go("index.home")})}angular.module("app").run(run),run.$inject=["$rootScope","$state","$mdSidenav","$mdBottomSheet","auth","webStorage","$window","api","$mdMedia","mensajes"]}(),function(){"use strict";function transicion($resource,api){function enter(element,done){element.css("opacity",0)}function leave(element,done){element.css("opacity",0)}var animacion={enter:enter,leave:leave};return animacion}angular.module("app").animation(".transicion",transicion)}(),function(){"use strict";function InteraccionCtrl($rootScope){function ir(ruta){$mdSidenav("left").isOpen()&&$mdSidenav("left").toggle(),$state.go(ruta)}var it=this;it.nombre=$rootScope.nombre,it.ir=ir}angular.module("app").component("interaccion",{templateUrl:"views/interaccion.html",controller:InteraccionCtrl,controllerAs:"it"}),InteraccionCtrl.$inject=["$rootScope"]}(),function(){"use strict";function MenuCtrl($rootScope,$state,$mdSidenav){function ir(ruta){$mdSidenav("left").isOpen()&&$mdSidenav("left").toggle(),$state.go(ruta)}var mn=this;mn.nombre=$rootScope.nombre,mn.ir=ir}angular.module("app").component("menu",{templateUrl:"views/menu.html",controller:MenuCtrl,controllerAs:"mn"}),MenuCtrl.$inject=["$rootScope","$state","$mdSidenav"]}(),function(){"use strict";function toolbarCtrl($rootScope,auth,$mdSidenav,$mdMedia,$window){function menuSwitch(menuId){$rootScope.atras?$window.history.back():$mdSidenav(menuId).toggle()}function configSwitch(menuId){$mdSidenav(menuId).toggle()}function logout(){auth.logout()}function verificaVista(){return $mdMedia("gt-md")?!!$rootScope.atras:!0}var tb=this;console.log($rootScope.url),tb.configSwitch=configSwitch,tb.menuSwitch=menuSwitch,tb.logout=logout,tb.verificaVista=verificaVista,tb.nombre=$rootScope.nombre,tb.unidad=$rootScope.nombreUni}angular.module("app").component("toolbar",{templateUrl:"views/toolbar.html",controller:toolbarCtrl,controllerAs:"tb",bindings:{titulo:"=",menu:"=",url:"="}})}(),function(){"use strict";function ayudaCtrl($rootScope,$mdDialog){var au=this;$rootScope.tema="theme1",$rootScope.titulo="Ayuda",$rootScope.atras=!0,$rootScope.menu="arrow_back",au.video=function(ev,opcion){switch(opcion){case 1:var video="http://medicavial.net/mvred/videos/3_Numero_de%20faltas_y_retardos%20LIC_MARIANA_SANCHEZ.mp4";break;case 2:var video="http://medicavial.net/mvred/videos/5_Expedientes_completos_ING_ALFREDO_GUTIERREZ.mp4";break;case 3:var video="http://medicavial.net/mvred/videos/7_Tiempo_de_espera_ING_ALFREDO_GUTIERREZ.mp4"}$mdDialog.show({controller:"videoCtrl",controllerAs:"vi",templateUrl:"views/videos.html",locals:{video:video},parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0})},au.directorio=function(ev){$mdDialog.show({templateUrl:"views/directorio.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0,controller:function($scope,$mdDialog){$scope.cerrar=function(){$mdDialog.cancel()}}})}}function videoCtrl($mdDialog,video){var vi=this;vi.video=video,vi.options={loop:!0},vi.info={sources:[{src:video,type:"video/mp4"}]},vi.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("ayudaCtrl",ayudaCtrl).controller("videoCtrl",videoCtrl),ayudaCtrl.$inject=["$rootScope","$mdDialog"],videoCtrl.$inject=["$mdDialog","video"]}(),function(){"use strict";function busquedaCtrl($rootScope,registros,mensajes,publicfiles){function buscar(){bs.consultando=!0,bs.consulta=registros.get(bs.datos,muestraDatos).$promise}function inicio(){bs.datos={unidad:$rootScope.unidad,page:1,folio:"",lesionado:"",limit:10,order:"-Exp_fecreg"},bs.lesionado="",bs.folio="",bs.consultando=!1,bs.pageSelect=!0,buscar()}function muestraDatos(response){bs.registros=response.data,bs.limite=response.per_page,bs.pagina=response.current_page,bs.total=response.total,bs.consultando=!1}function ordenar(order){console.log("Scope Order: "+bs.order),console.log("Order: "+order)}var bs=this;$rootScope.titulo="Consulta de registros",$rootScope.atras=!0,$rootScope.menu="arrow_back",bs.inicio=inicio,bs.buscar=buscar,bs.ordenar=ordenar,bs.detalle=[],bs.selected=[],bs.muestraDetalle=function(folio){console.log(folio)},bs.paginacion=[10,20,30,40,50]}function busquedaGeneralCtrl($rootScope,registrosGlobales,mensajes,publicfiles){function buscar(){bs.consultando=!0,bs.consulta=registrosGlobales.get(bs.datos,muestraDatos).$promise}function inicio(){bs.datos={unidad:$rootScope.unidad,page:1,folio:"",lesionado:"",limit:10,order:"-Exp_fecreg"},bs.lesionado="",bs.folio="",bs.consultando=!1,bs.pageSelect=!0}function muestraDatos(response){bs.registros=response.data,bs.limite=response.per_page,bs.pagina=response.current_page,bs.total=response.total,bs.consultando=!1}function ordenar(order){console.log("Scope Order: "+bs.order),console.log("Order: "+order)}var bs=this;$rootScope.titulo="Consulta de registros",$rootScope.atras=!0,$rootScope.menu="arrow_back",bs.inicio=inicio,bs.buscar=buscar,bs.ordenar=ordenar,bs.detalle=[],bs.muestraDetalle=function(index,folio){bs.detalle[index]=!bs.detalle[index],bs.dato=folio},bs.paginacion=[10,20,30,40,50]}angular.module("app").controller("busquedaCtrl",busquedaCtrl).controller("busquedaGeneralCtrl",busquedaGeneralCtrl),busquedaCtrl.$inject=["$rootScope","registros","mensajes","publicfiles"],busquedaGeneralCtrl.$inject=["$rootScope","registrosGlobales","mensajes","publicfiles"]}(),function(){"use strict";function detalleCtrl($rootScope,datos,busqueda,mensajes,publicfiles){function inicio(){dt.dato=datos.data,dt.codigo=publicfiles+"codigos/"+dt.dato.Exp_folio+".png",dt.isOpen=!1,dt.seleccionado=!0,dt.seccion=!1,dt.detalle=!0,dt.iconPanel="expand_less",cargaDatosFolio(dt.dato.Exp_folio)}function muestraSeccion(page,icon,color){dt.page=page,dt.icon=icon,dt.bg=color,dt.seccion=!0,muestraPanel()}function cierraSeccion(page,icon){dt.seccion=!1,dt.detalle||muestraPanel()}function muestraPanel(){dt.detalle=!dt.detalle,1==dt.detalle?dt.iconPanel="expand_less":dt.iconPanel="expand_more"}function subirDigitalesEt1(files){for(var i=0;i<files.length;i++){var file=files[i];file.$error?mensajes.alerta("Formato Invalido","","top right","error"):console.log(file)}}function cargaDatosFolio(folio){busqueda.datos(folio).then(function(data){dt.tickets=data.tickets,console.log(data)})}var dt=this;$rootScope.titulo="Detalle del Folio: "+datos.data.Exp_folio,$rootScope.atras=!0,$rootScope.menu="arrow_back",dt.secciones=[{nombre:"Atenciones",background:"blueGray400",icon:"folder_shared",col:"1",row:"1",size:"84",page:"views/atenciones.html"},{nombre:"Autorizaciones",background:"teal",icon:"beenhere",col:"1",row:"1",size:"84",page:"views/autorizaciones.html"},{nombre:"Problemas de Expediente",background:"red400",icon:"warning",col:"1",row:"1",size:"84",page:"views/tickets.html"},{nombre:"Pagos",background:"green600",icon:"credit_card",col:"1",row:"1",size:"84",page:"views/pagosExpediente.html"},{nombre:"Linea de Tiempo",background:"purple400",icon:"toc",col:"1",row:"1",size:"84",page:"views/timeline.html"},{nombre:"Interaccion",background:"indigo400",icon:"chat",col:"1",row:"1",size:"84",page:"views/comunicacion.html"}],dt.inicio=inicio,dt.muestraSeccion=muestraSeccion,dt.cierraSeccion=cierraSeccion,dt.subirDigitalesEt1=subirDigitalesEt1,dt.muestraPanel=muestraPanel}angular.module("app").controller("detalleCtrl",detalleCtrl),detalleCtrl.$inject=["$rootScope","datos","busqueda","mensajes","publicfiles"]}(),function(){"use strict";function estadisticasCtrl($rootScope,$mdDialog,datos){var et=this;$rootScope.titulo="Estadisticas",$rootScope.atras=!0,$rootScope.menu="arrow_back",et.meses={data:datos[1].data,type:"serial",categoryField:"MES",rotate:!1,legend:{enabled:!1},chartScrollbar:{enabled:!1},graphs:[{type:"column",title:"Cantidad",valueField:"Cantidad",fillAlphas:.9,balloonText:"[[category]]<br><b>Atenciones: [[value]]</b>"}]},et.semanas={data:datos[0].data,type:"serial",categoryField:"Semana",rotate:!1,legend:{enabled:!1},chartScrollbar:{enabled:!1},graphs:[{type:"column",title:"Cantidad",valueField:"Cantidad",fillAlphas:.9,balloonText:"[[category]]<br><b>Atenciones: [[value]]</b>"}]}}angular.module("app").controller("estadisticasCtrl",estadisticasCtrl),estadisticasCtrl.$inject=["$rootScope","$mdDialog","datos"]}(),function(){"use strict";function formatosCtrl($rootScope,$mdDialog){var au=this;$rootScope.tema="theme1",$rootScope.titulo="Fomatos",$rootScope.atras=!0,$rootScope.menu="arrow_back",au.video=function(ev,opcion){switch(opcion){case 1:var video="http://medicavial.net/mvred/videos/3_Numero_de%20faltas_y_retardos%20LIC_MARIANA_SANCHEZ.mp4";break;case 2:var video="http://medicavial.net/mvred/videos/5_Expedientes_completos_ING_ALFREDO_GUTIERREZ.mp4";break;case 3:var video="http://medicavial.net/mvred/videos/7_Tiempo_de_espera_ING_ALFREDO_GUTIERREZ.mp4"}$mdDialog.show({controller:"archivoCtrl",controllerAs:"vi",templateUrl:"views/videos.html",locals:{video:video},parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0})},au.directorio=function(ev){$mdDialog.show({templateUrl:"views/directorio.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0,controller:function($scope,$mdDialog){$scope.cerrar=function(){$mdDialog.cancel()}}})}}function archivoCtrl($mdDialog,video){var vi=this;vi.video=video,vi.options={loop:!0},vi.info={sources:[{src:video,type:"video/mp4"}]},vi.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("formatosCtrl",formatosCtrl).controller("archivoCtrl",archivoCtrl),formatosCtrl.$inject=["$rootScope","$mdDialog"],archivoCtrl.$inject=["$mdDialog","video"]}(),function(){"use strict";function homeCtrl($rootScope){var hm=this;$rootScope.tema="theme1",$rootScope.titulo="Bienvenido",hm.secciones=[{nombre:"Registro",background:"blueG",icon:"assignment",col:"2",row:"1",size:"104",permiso:!0,url:"index.registro"},{nombre:"Formatos",background:"greenG",icon:"insert_drive_file",col:"2",row:"1",size:"84",permiso:!0,url:"index.formatos"},{nombre:"Ayuda",background:"orangeG",icon:"help",col:"2",row:"1",size:"84",permiso:!0,url:"index.ayuda"},{nombre:"Expediente",background:"redG",icon:"search",col:"2",row:"1",size:"84",permiso:!0,url:"index.busqueda"},{nombre:"Conciliación",background:"grayG",icon:"attach_money",col:"1",row:"1",size:"84",permiso:!0,url:"index.registro"},{nombre:"Estadistica",background:"yellowG",icon:"show_chart",col:"1",row:"1",size:"84",permiso:!0,url:"index.estadisticas"},{nombre:"Consulta General",background:"bgm-brown",icon:"search",col:"2",row:"1",size:"84",permiso:!0,url:"index.busquedaGeneral"}]}angular.module("app").controller("homeCtrl",homeCtrl),homeCtrl.$inject=["$rootScope"]}(),function(){"use strict";function loginCtrl(auth,$rootScope){var sesion=this;$rootScope.cargando=!1,$rootScope.tema="theme1",sesion.inicio=function(){sesion.datos={usuario:"",psw:"",guardar:!1}},sesion.login=function(){sesion.loginForm.$valid&&($rootScope.cargando=!0,auth.login(sesion.datos))}}angular.module("app").controller("loginCtrl",loginCtrl),loginCtrl.$inject=["auth","$rootScope"]}(),function(){"use strict";function registroCtrl($rootScope,datos,busqueda,$mdDialog,$q,$filter,operacion,mensajes,publicfiles,$mdpDatePicker){function agregaTelefono(ev){$mdDialog.show({controller:"telefonoCtrl",controllerAs:"tel",templateUrl:"views/agregaTelefono.html",parent:angular.element(document.body),targetEvent:ev,locals:{tipos:vm.tipos,telefonos:vm.telefonos},clickOutsideToClose:!1,fullscreen:!0}).then(function(telefonos){vm.telefonos=telefonos})}function buscaAjustador(query){var q=$q.defer(),response=query?$filter("filter")(vm.ajustadores,query):vm.ajustadores;return q.resolve(response),q.promise}function confirmaProducto(producto){vm.errorInfo?(mensajes.alerta(error,"error","top right","alert"),consultaInfo()):(vm.tabActual=2,vm.step1block=!0,vm.step2block=!0,vm.step3block=!1,vm.imagenProducto=producto.Pro_img,vm.datos.producto=producto.Pro_clave)}function consultaInfo(){var tipos=busqueda.tipos(),riesgos=busqueda.riesgos(),ajustadores=busqueda.ajustadores();$q.all([tipos,riesgos,ajustadores]).then(function(data){vm.tipos=data[0].data,vm.riesgos=data[1].data,vm.ajustadores=data[2].data},function(error){vm.errorInfo=!0})}function detalleAjustador(ajustador){console.log(ajustador),void 0!=ajustador?(vm.datoSiniestro.ajustador=ajustador.AJU_nombre,vm.datoSiniestro.telAjustador=ajustador.AJU_tel,vm.datoSiniestro.cveAjustador=ajustador.AJU_clavease,vm.datoSiniestro.cveAjustadorMv=ajustador.AJU_claveint,vm.ajustadorExiste=!0):(vm.ajustadorExiste=!1,vm.datoSiniestro.telAjustador="",vm.datoSiniestro.cveAjustador="",vm.datoSiniestro.cveAjustadorMv="")}function guardaPaciente(){vm.registroForm.$valid&&(vm.guardando=!0,operacion.registroPaciente(vm.datos).success(function(data){vm.guardando=!1,vm.step4block=!1,vm.tabActual=3,vm.step3block=!0,vm.datoSiniestro.folio=data.folio,vm.imagenFolio=publicfiles+data.codigo,vm.registro=data.registro,mensajes.alerta(data.respuesta,"success","top right","done_all")}).error(function(error){vm.guardando=!1,error?mensajes.alerta(error,"error","top right","done_all"):mensajes.alerta(mensajeError,"error","top right","done_all")}))}function guardaSiniestro(){vm.siniestroForm.$valid&&(vm.datoSiniestro.ajustador.toUpperCase(),vm.guardando=!0,operacion.registroSiniestro(vm.datoSiniestro).success(function(data){vm.guardando=!1,vm.step5block=!1,vm.tabActual=4,vm.step4block=!0,mensajes.alerta(data.respuesta,"success","top right","done_all")}).error(function(error){vm.guardando=!1,mensajes.alerta(mensajeError,"error","top right","done_all")}))}function inicio(){vm.step1block=!1,vm.step2block=!0,vm.step3block=!0,vm.step4block=!0,vm.step5block=!0,vm.consultando=!1,vm.guardando=!1,vm.ajustadorExiste=!1,vm.errorInfo=!1,vm.tabActual=0,vm.telefonos=[],vm.productos=[],vm.imagenCliente="",vm.imagenProducto="",vm.imagenFolio="",vm.compania="",vm.registro="",vm.datos={unidad:$rootScope.unidad,localidad:$rootScope.localidad,usuario:$rootScope.id,cliente:"",producto:"",telefono:"",telefonos:vm.telefonos,correo:"",nombre:"",apaterno:"",amaterno:"",folioInterno:"",fechaNac:new Date(vm.fecha)},vm.datoSiniestro={folio:"",tipotel:"",poliza:"",localidad:$rootScope.localidad,cliente:vm.datos.cliente,folioElec:"",inciso:"",siniestro:"",reporte:"",orden:"",bitacora:"",ilejible:!1,ajustador:"",ajustadorId:"",cveAjustador:"",cveAjustadorMv:"",telAjustador:"",bitacora:"",observaciones:"",deducible:!1,reporte:"",observacionesDeducible:"",fechaAtencion:"",extemporaneo:!1,motivoEx:""},consultaInfo()}function resetForms(){vm.registroForm.$setPristine(),vm.siniestroForm.$setPristine(),inicio()}function verificaObligatorio(){return""==vm.datoSiniestro.siniestro&&""==vm.datoSiniestro.bitacora&&""==vm.datoSiniestro.reporte}function verificaProducto(cliente){vm.productos=[],vm.consultando=!0,vm.tabActual=1,vm.step2block=!1,vm.errorInfo&&consultaInfo(),busqueda.productosCliente(cliente.Cia_clave,vm.datos.localidad).success(function(data){if(vm.productos=data,vm.consultando=!1,vm.datos.cliente=cliente.Cia_clave,vm.imagenCliente=cliente.Cia_logo,vm.compania=cliente.Cia_nombrecorto,1==vm.productos.length){var producto=vm.productos[0];confirmaProducto(producto)}})}var vm=this;vm.fecha=moment().subtract(25,"year");var fecha=new Date(vm.fecha);console.log(fecha);var mensajeError="Ocurrio un error al guardar intentelo nuevamente";$rootScope.titulo="Registro de Paciente",$rootScope.atras=!0,$rootScope.menu="arrow_back",vm.clientes=datos.clientes,vm.paso1="views/registroPaso1.html",vm.paso2="views/registroPaso2.html",vm.paso3="views/registroPaso3.html",vm.paso4="views/registroPaso4.html",vm.inicio=inicio,vm.agregaTelefono=agregaTelefono,vm.buscaAjustador=buscaAjustador,vm.confirmaProducto=confirmaProducto,vm.guardaPaciente=guardaPaciente,vm.guardaSiniestro=guardaSiniestro,vm.verificaProducto=verificaProducto,vm.detalleAjustador=detalleAjustador,vm.resetForms=resetForms,vm.consultaInfo=consultaInfo,vm.verificaObligatorio=verificaObligatorio}function telefonoCtrl($mdDialog,tipos,telefonos){function inicio(){tel.telefono="",tel.tipoTel=""}function agregaTelefono(){tel.telefonos.push({telefono:tel.telefono,tipo:tel.tipoTel.TT_clave,nombre:tel.tipoTel.TT_tipotelefono}),inicio()}function cancelar(){$mdDialog.cancel()}function ingresa(){$mdDialog.hide(tel.telefonos)}var tel=this;tel.tipos=tipos,tel.telefonos=telefonos,tel.inicio=inicio,tel.agregaTelefono=agregaTelefono,tel.cancelar=cancelar,tel.ingresa=ingresa}angular.module("app").controller("registroCtrl",registroCtrl).controller("telefonoCtrl",telefonoCtrl),registroCtrl.$inject=["$rootScope","datos","busqueda","$mdDialog","$q","$filter","operacion","mensajes","publicfiles","$mdpDatePicker"],telefonoCtrl.$inject=["$mdDialog","tipos","telefonos"]}(),function(){"use strict";angular.module("app").directive("dragEnd",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){var functionToCall=scope.$eval(attrs.dragEnd);element.on("$md.dragend",function(){functionToCall(modelCtrl.$viewValue)}),element.on("click",function(){functionToCall(modelCtrl.$viewValue)})}}})}(),function(){"use strict";angular.module("app").directive("backButton",["$window",function($window){return{restrict:"A",link:function(scope,elem){elem.bind("click",function(){$window.history.back()})}}}])}(),function(){"use strict";angular.module("app").directive("expandColor",function($animate){function link(scope,element,attrs){var color=attrs.expandColor;console.log(color),element.on("click",function(){var iDiv=document.createElement("div");iDiv.className="box",element.append(iDiv),angular.element(iDiv).addClass(color),angular.element(iDiv).addClass("active")})}return{link:link}})}(),function(){"use strict";angular.module("app").directive("folio",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){var rellenaFolio=function(folio){if(""!==folio){var totalletras=folio.length,letras=folio.substr(0,4),numeros=folio.substr(4,totalletras);if(letras.length<4)for(var faltantes=4-letras.length,i=0;faltantes>i;i++){letras.charAt(i);letras+="0"}if(numeros.length<6)for(var faltantes=6-numeros.length,i=0;faltantes>i;i++)numeros="0"+numeros;return folio=letras+numeros}return folio};element.on("blur",function(){if(modelCtrl.$modelValue.length>3){var nuevo=rellenaFolio(modelCtrl.$modelValue);modelCtrl.$setViewValue(nuevo.toUpperCase()),modelCtrl.$render(),scope.$apply()}}),element.on("keydown",function(e){if(modelCtrl.$modelValue){var cantidad=modelCtrl.$modelValue.length;if(4>cantidad)e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105?e.preventDefault():element.css("text-transform","uppercase");else if(cantidad>3&&10>cantidad){if(e.keyCode>=65&&e.keyCode<=90)e.preventDefault();else if(13==e.keyCode){var nuevo=rellenaFolio(modelCtrl.$modelValue);modelCtrl.$setViewValue(nuevo.toUpperCase()),modelCtrl.$render(),scope.$apply()}}else(e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105)&&e.preventDefault()}})}}})}(),function(){"use strict";angular.module("app").directive("imageonload",function(){return{restrict:"A",link:function(scope,element){element.on("load",function(){element.removeClass("spinner-hide"),element.addClass("spinner-show"),element.parent().find("span").remove()}),scope.$watch("ngSrc",function(){element.addClass("spinner-hide")})}}})}(),function(){"use strict";angular.module("app").directive("mayusculas",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){element.bind("blur",function(){var inputValue=modelCtrl.$modelValue;if(inputValue){var capitalized=inputValue.toUpperCase();capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render())}}),element.css("text-transform","uppercase")}}})}(),function(){"use strict";angular.module("app").directive("dinero",function(){function link(scope,el,attrs,ngModelCtrl){function round(num){var d=Math.pow(10,precision);return Math.round(num*d)/d}function formatPrecision(value){return parseFloat(value).toFixed(precision)}function formatViewValue(value){return ngModelCtrl.$isEmpty(value)?"":""+value}var lastValidValue,min=parseFloat(attrs.min||0),precision=parseFloat(attrs.precision||2);ngModelCtrl.$parsers.push(function(value){0===value.indexOf(".")&&(value="0"+value),0===value.indexOf("-")&&(min>=0?(value=null,ngModelCtrl.$setViewValue(""),ngModelCtrl.$render()):"-"===value&&(value=""));var empty=ngModelCtrl.$isEmpty(value);return empty||NUMBER_REGEXP.test(value)?lastValidValue=""===value?null:empty?value:parseFloat(value):(ngModelCtrl.$setViewValue(formatViewValue(lastValidValue)),ngModelCtrl.$render()),ngModelCtrl.$setValidity("number",!0),lastValidValue}),ngModelCtrl.$formatters.push(formatViewValue);var minValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&min>value?void ngModelCtrl.$setValidity("min",!1):(ngModelCtrl.$setValidity("min",!0),value)};if(ngModelCtrl.$parsers.push(minValidator),ngModelCtrl.$formatters.push(minValidator),attrs.max){var max=parseFloat(attrs.max),maxValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&value>max?void ngModelCtrl.$setValidity("max",!1):(ngModelCtrl.$setValidity("max",!0),value)};ngModelCtrl.$parsers.push(maxValidator),ngModelCtrl.$formatters.push(maxValidator)}precision>-1&&(ngModelCtrl.$parsers.push(function(value){return value?round(value):value}),ngModelCtrl.$formatters.push(function(value){return value?formatPrecision(value):value})),el.bind("blur",function(){var value=ngModelCtrl.$modelValue;value&&(ngModelCtrl.$viewValue=formatPrecision(value),ngModelCtrl.$render())})}var NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:link}})}(),function(){"use strict";angular.module("app").directive("ngMorphingModal",function(){var randLetter=String.fromCharCode(65+Math.floor(26*Math.random()));randLetter+Date.now();return{replace:!0,restrict:"AE",scope:{contentSelector:"@"},link:function(scope,element,attributes){new MorphingModal({selectorId:'[data-type="modal-trigger"]',selectorObj:$('[data-type="modal-trigger"]'),contentSelector:scope.contentSelector,onAfterClose:null,onAfterOpen:function(){}})},templateUrl:"../js/td-modal.html"}})}(),function(){"use strict";angular.module("app").directive("numero",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){element.on("keydown",function(e){(e.keyCode>=65&&e.keyCode<=90||110==e.keyCode||190==e.keyCode||189==e.keyCode)&&e.preventDefault()})}}})}(),function(){"use strict";function auth($http,api,$state,webStorage,$rootScope,mensajes){return{login:function(credenciales){$http.post(api+"login",credenciales).success(function(data){$rootScope.cargando=!1,webStorage.session.add("username",data.Usu_login),webStorage.session.add("nombre",data.Usu_nombre),webStorage.session.add("id",data.Usu_login),webStorage.session.add("localidad",data.LOC_claveint),webStorage.session.add("unidad",data.Uni_clave),webStorage.session.add("nombreUni",data.Uni_nombrecorto),webStorage.session.add("permisos",JSON.stringify(data)),$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),$rootScope.localidad=webStorage.session.get("localidad"),$rootScope.unidad=webStorage.session.get("unidad"),$rootScope.nombreUni=webStorage.session.get("nombreUni"),$rootScope.permisos=JSON.parse(webStorage.session.get("permisos")),credenciales.guardar&&webStorage.local.add("usuario",JSON.stringify(data)),$state.go("index.home")}).error(function(data){data?mensajes.alerta(data.flash,"error center-dialog","top","error"):mensajes.alerta("Error en conexión intentalo nuevamente","error center-dialog","top","error"),$rootScope.cargando=!1})},logout:function(){webStorage.session.clear(),$http.get(api+"logout"),$state.go("login")},verify:function(api){}}}angular.module("app").factory("auth",auth)}(),function(){"use strict";function busqueda($http,$rootScope,api,$q){function ajustadores(){return $http.get(api+"busqueda/ajustadores/"+$rootScope.localidad,{timeout:1e4})}function clientes(){return $http.get(api+"busqueda/clientes",{timeout:1e4})}function detalleFolio(folio){return $http.get(api+"busqueda/detalleFolio/"+folio,{timeout:1e4})}function productos(){return $http.get(api+"busqueda/productos",{timeout:1e4})}function productosCliente(cliente,localidad){return $http.get(api+"busqueda/productos/"+cliente+"/"+localidad,{timeout:1e4})}function riesgos(){return $http.get(api+"busqueda/riesgos",{timeout:1e4})}function registros(datos){console.log(datos);var promesa=$q.defer(),parametros="unidad="+$rootScope.unidad;void 0!==datos&&(datos.folio&&(parametros=parametros+"&folio="+datos.folio),datos.lesionado&&(parametros=parametros+"&lesionado="+datos.lesionado));var consulta=$http.get(api+"busqueda/registros?"+parametros,{timeout:1e4});return $q.when(consulta).then(function(datos){console.log(datos),datos.data.length>0?promesa.resolve(datos.data):promesa.reject("No se encontraron coincidencias.")},function(error){promesa.reject("Ocurrio un error intentelo nuevamente")}),promesa.promise}function datos(folio){var promesa=$q.defer(),tickets=$http.get(api+"busqueda/tickets/"+folio,{timeout:1e4});return $q.all([tickets]).then(function(data){datos={tickets:data[0].data},promesa.resolve(datos)},function(error){promesa.reject("error en conexión")}),promesa.promise}function tipos(){return $http.get(api+"busqueda/tipos",{timeout:1e4})}var servicio={ajustadores:ajustadores,clientes:clientes,datos:datos,detalleFolio:detalleFolio,productos:productos,productosCliente:productosCliente,registros:registros,riesgos:riesgos,tipos:tipos};return servicio}angular.module("app").factory("busqueda",busqueda)}(),function(){"use strict";function mensajes($mdToast,$mdDialog,$q){return{confirmacion:function(titulo,mensaje,ev){var confirm=$mdDialog.confirm().title(titulo).content(mensaje).ariaLabel("Confirmación").targetEvent(ev).ok("SI").cancel("NO");$mdDialog.show(confirm).then(function(){return!0},function(){return!1})},notifica:function(mensaje,descripcion,ev){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(mensaje).content(descripcion).ariaLabel(mensaje).ok("OK").targetEvent(ev));
},alerta:function(mensaje,tipo,posicion,icono){$mdToast.show({template:'<md-toast class="'+tipo+'"> <md-icon class="padding-right"> <ng-md-icon icon="'+icono+'" style="fill:white"></ng-md-icon></md-icon> <span flex>'+mensaje+"</span></md-toast>",hideDelay:4e3,position:posicion})},popup:function(mensaje){}}}angular.module("app").factory("mensajes",mensajes)}(),function(){"use strict";function operacion($http,$rootScope,$q,api){function registroPaciente(datos){return $http.post(api+"operacion/registraFolio",datos,{timeout:1e4})}function registroSiniestro(datos){return $http.post(api+"operacion/registraSiniestro",datos,{timeout:1e4})}var operacion={registroPaciente:registroPaciente,registroSiniestro:registroSiniestro};return operacion}angular.module("app").factory("operacion",operacion)}(),function(){"use strict";function registrosGlobales($resource,api){return $resource(api+"busqueda/registrosGlobales",{},{get:{method:"GET",timeout:1e4}})}angular.module("app").factory("registrosGlobales",registrosGlobales)}(),function(){"use strict";function registros($resource,api){return $resource(api+"busqueda/registros")}angular.module("app").factory("registros",registros)}(),function(){"use strict";function reportes($http,$rootScope,api,$q){function atencionesAnio(){return $http.get(api+"reportes/atenciones/anio/"+$rootScope.unidad,{timeout:1e4})}function atencionesMes(){return $http.get(api+"reportes/atenciones/mes/"+$rootScope.unidad,{timeout:1e4})}var servicio={atencionesAnio:atencionesAnio,atencionesMes:atencionesMes};return servicio}angular.module("app").factory("reportes",reportes)}(),function(){"use strict";function usuarios($resource,api){var User=$resource(api+"usuarios/:usuario",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return User}angular.module("app").factory("usuarios",usuarios)}();