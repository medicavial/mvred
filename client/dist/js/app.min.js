!function(){"use strict";angular.module("app",["ui.router","ngMaterial","ngMdIcons","webStorageModule","ngMessages","ngResource","ngAnimate","md.data.table","ngFileUpload","angular.filter","mdPickers","material.components.expansionPanels","vjs.video","amChartsDirective"]).constant("api","http://api.medicavial.net/api/").constant("publicfiles","http://api.medicavial.net/")}(),function(){"use strict";function config($stateProvider,$urlRouterProvider,$locationProvider,$mdThemingProvider,$httpProvider,$compileProvider,$mdDateLocaleProvider,$sceDelegateProvider){$compileProvider.debugInfoEnabled(!0),$sceDelegateProvider.resourceUrlWhitelist(["self","http://medicavial.net/**","http://localhost/**"]),$mdDateLocaleProvider.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],$mdDateLocaleProvider.shortMonths=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],$mdDateLocaleProvider.days=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado"],$mdDateLocaleProvider.shortDays=["Do","Lu","Ma","Mi","Ju","Vi","Sa"],moment.locale("es"),$mdDateLocaleProvider.formatDate=function(date){return date?moment(date).format("DD/MM/YYYY"):""},$mdDateLocaleProvider.parseDate=function(dateString){var m=moment(dateString,"DD/MM/YYYY",!0);return m.isValid()?m.toDate():new Date(NaN)},$urlRouterProvider.otherwise("/home"),$stateProvider.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl",controllerAs:"sesion"}).state("index",{url:"/","abstract":!0,templateUrl:"views/base.html"}).state("index.ayuda",{url:"ayuda",templateUrl:"views/ayuda.html",controller:"ayudaCtrl",controllerAs:"au"}).state("index.busqueda",{url:"busqueda",templateUrl:"views/busqueda.html",controller:"busquedaCtrl",controllerAs:"bs"}).state("index.busquedaGeneral",{url:"busquedaGeneral",templateUrl:"views/busqueda.html",controller:"busquedaGeneralCtrl",controllerAs:"bs"}).state("index.documentos",{url:"documentos",templateUrl:"views/documentos.html",controller:"documentosCtrl",controllerAs:"dc",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),productos=busqueda.productos(),tiposAtencion=busqueda.tiposAtencion(),tiposDocumento=busqueda.tiposDocumento();return $q.all([tiposDocumento,tiposAtencion,productos]).then(function(data){promesa.resolve(data)},function(error){promesa.reject("Error")}),promesa.promise}}}).state("index.estadisticas",{url:"estadisticas",templateUrl:"views/estadisticas.html",controller:"estadisticasCtrl",controllerAs:"et",resolve:{datos:function(reportes,$q){var promesa=$q.defer(),estadisticas=reportes.estadisticas(),atencionesMes=reportes.atencionesMes(),atencionesAnio=reportes.atencionesAnio();return $q.all([atencionesMes,atencionesAnio,estadisticas]).then(function(data){promesa.resolve(data)},function(error){promesa.reject("Error")}),promesa.promise}}}).state("index.estadistica",{url:"estadistica?tipo",templateUrl:"views/estadistica.html",controller:"estadisticaCtrl",controllerAs:"es",resolve:{datos:function(reportes,$q,$stateParams){return reportes.detalleEstadistica($stateParams.tipo)}}}).state("index.formatos",{url:"formatos",templateUrl:"views/formatos.html",controller:"formatosCtrl",controllerAs:"fr"}).state("index.home",{url:"home",templateUrl:"views/home.html",controller:"homeCtrl",controllerAs:"hm"}).state("index.registro",{url:"registro",templateUrl:"views/registro.html",controller:"registroCtrl",controllerAs:"rg",resolve:{datos:function(busqueda,$q){var promesa=$q.defer(),clientes=busqueda.clientes();return $q.all([clientes]).then(function(data){var datos={clientes:data[0].data};promesa.resolve(datos)},function(error){promesa.reject("error en consulta")}),promesa.promise}}}).state("index.detalle",{url:"detalle?folio",templateUrl:"views/detalle.html",controller:"detalleCtrl",controllerAs:"dt",resolve:{datos:function(busqueda,$stateParams){return busqueda.detalleFolio($stateParams.folio)}},reload:!0}),$locationProvider.html5Mode(!0),$mdThemingProvider.theme("theme1").primaryPalette("indigo").accentPalette("red"),$mdThemingProvider.theme("theme2").primaryPalette("deep-orange").warnPalette("indigo").accentPalette("red"),$mdThemingProvider.theme("theme3").primaryPalette("neonBlue").accentPalette("red"),$mdThemingProvider.theme("theme4").primaryPalette("blue-grey").accentPalette("red"),$mdThemingProvider.theme("theme5").primaryPalette("neonGreen").accentPalette("red"),$mdThemingProvider.theme("theme6").primaryPalette("deep-purple").accentPalette("red"),$mdThemingProvider.theme("docs-dark").primaryPalette("red").dark();var neonBlueMap=$mdThemingProvider.extendPalette("blue",{500:"#3175E7",contrastDefaultColor:"light"}),neonGreenMap=$mdThemingProvider.extendPalette("green",{500:"#259B24",contrastDefaultColor:"light"});$mdThemingProvider.definePalette("neonBlue",neonBlueMap),$mdThemingProvider.definePalette("neonGreen",neonGreenMap),$mdThemingProvider.setDefaultTheme("theme1"),$mdThemingProvider.alwaysWatchTheme(!0),$httpProvider.defaults.timeout=1e3}angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider","$httpProvider","$compileProvider","$mdDateLocaleProvider","$sceDelegateProvider"]}(),function(){"use strict";function run($rootScope,$state,$mdSidenav,$mdBottomSheet,auth,webStorage,$window,api,$mdMedia,mensajes){$rootScope.atras=!1,$rootScope.modoGuiado=!0,$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),$rootScope.localidad=webStorage.session.get("localidad"),$rootScope.unidad=webStorage.session.get("unidad"),$rootScope.nombreUni=webStorage.session.get("nombreUni"),$rootScope.permisos=JSON.parse(webStorage.session.get("permisos")),$rootScope.muestra=function(ruta){$state.go(ruta)},$rootScope.cambiaModo=function(){$rootScope.modoGuiado=!$rootScope.modoGuiado},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$rootScope.atras=!1,$rootScope.url=toState.name,"login"!==$rootScope.url&&null===webStorage.session.get("username")&&(event.preventDefault(),$state.go("login")),"login"===$rootScope.url&&null!==webStorage.session.get("username")&&(event.preventDefault(),$state.go("index.home")),$rootScope.cargando=!0}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$rootScope.cargando=!1,$rootScope.menu="menu"}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){$rootScope.cargando=!1,mensajes.alerta("Problemas de conexión intentalo nuevamente por favor","error","top right","error"),event.preventDefault(),$state.go("index.home")})}angular.module("app").run(run),run.$inject=["$rootScope","$state","$mdSidenav","$mdBottomSheet","auth","webStorage","$window","api","$mdMedia","mensajes"]}(),function(){"use strict";function transicion($resource,api){function enter(element,done){element.css("opacity",0)}function leave(element,done){element.css("opacity",0)}var animacion={enter:enter,leave:leave};return animacion}angular.module("app").animation(".transicion",transicion)}(),function(){"use strict";function atencionCtrl($rootScope,mensajes,$mdDialog,operacion,busqueda,webStorage){function inicio(){if(atn.solicitando=!1,webStorage.local.has(atn.clave)){var data=JSON.parse(webStorage.local.get(atn.clave));atn.datos=data.info,atn.tiposDocumento=data.tipos,atn.imagenes=data.imagenes}else cargaInfo()}function destruccion(){var datos={info:atn.datos,tipos:atn.tiposDocumento,anotaciones:atn.anotaciones,requisitos:atn.requisitos,imagenes:atn.imagenes};webStorage.local.add(atn.clave,JSON.stringify(datos))}function cargaInfo(){atn.subiendoImagen=!1,atn.cargando=!0,atn.opacidad={opacity:.3},busqueda.detalleAtencion(atn.clave).then(function(data){console.log(data),atn.datos=data.info,atn.tiposDocumento=data.tipos,atn.imagenes=data.imagenes,atn.cargando=!1,atn.anotaciones=data.anotaciones,atn.requisitos=data.requisitos,atn.lesiones=data.lesiones,atn.opacidad={}},function(error){mensajes.alerta("Error de Conexión vuelve a intentar","error","top right","error"),atn.cargando=!1,atn.opacidad={}})}function lesionMV(){busqueda.lesionMV(atn.datos.lesion).success(function(data){atn.lesionesMV=data})}function lesionCodificada(){busqueda.lesionCodificada(atn.datos.lesionMV).success(function(data){atn.lesionesCod=data})}function subirDigitales(files,tipo,ev){files.length>0&&(atn.subiendoImagen=!0,operacion.subirImagenes(tipo,files,atn.clave).then(function(datos){atn.imagenes.push(datos),mensajes.alerta("Imagen subida correctamente","success","top right","done_all"),atn.porcentaje="",atn.subiendoImagen=!1,atn.tipo="",atn.files=[]},function(error){mensajes.alerta(error,"error","top right","error"),atn.porcentaje="",atn.subiendoImagen=!1},function(porcentaje){atn.porcentaje=porcentaje}))}function solicitaAutorizacion(){var datos={atencion:atn.clave,usuario:$rootScope.id,requisitos:atn.anotaciones.length>0?"":atn.requisitos};atn.solicitando=!0,operacion.solicitaAutorizacion(datos).success(function(data){atn.datos.ATN_estatus=1,atn.solicitando=!1,mensajes.alerta(data.respuesta,"success","top right","done_all")}).error(function(error){atn.solicitando=!1,mensajes.alerta("Ocurrio un error vuelve a intentarlo por favor","error","top right","error")})}function eliminarDigitales(file,ev){var confirm=$mdDialog.confirm().title("Deseas eliminar este archivo?").textContent("").ariaLabel("¿Deseas eliminar imagen?").targetEvent(ev).ok("SI").cancel("NO");$mdDialog.show(confirm).then(function(){file.usuario=$rootScope.id,file.atencion=atn.clave,operacion.eliminaImagen(file).then(function(resp){atn.datos.ATN_estatus=0,mensajes.alerta(resp.data.flash,"success","top right","done_all");var index=atn.imagenes.indexOf(file);atn.imagenes.splice(index,1)},function(error){mensajes.alerta(error,"error","top right","error")})})}function motivo(motivo,ev){var alert=$mdDialog.alert().title("Motivo de rechazo").textContent(motivo).ariaLabel("Motivo de rechazo").targetEvent(ev).ok("Cerrar");$mdDialog.show(alert)}function muestraArchivo(imagen,ev){$mdDialog.show({templateUrl:"views/visor.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,locals:{imagen:imagen},fullscreen:!0,controller:"visorCtrl"})}var atn=this;atn.$onInit=inicio,atn.$onDestroy=destruccion,atn.cargaInfo=cargaInfo,atn.eliminarDigitales=eliminarDigitales,atn.lesionMV=lesionMV,atn.lesionCodificada=lesionCodificada,atn.motivo=motivo,atn.muestraArchivo=muestraArchivo,atn.subirDigitales=subirDigitales,atn.solicitaAutorizacion=solicitaAutorizacion}angular.module("app").component("atencion",{templateUrl:"views/atencion.html",controller:atencionCtrl,controllerAs:"atn",bindings:{clave:"="}}),atencionCtrl.$inject=["$rootScope","mensajes","$mdDialog","operacion","busqueda","webStorage"]}(),function(){"use strict";function InteraccionCtrl($rootScope){function ir(ruta){$mdSidenav("left").isOpen()&&$mdSidenav("left").toggle(),$state.go(ruta)}var it=this;it.nombre=$rootScope.nombre,it.ir=ir}angular.module("app").component("interaccion",{templateUrl:"views/interaccion.html",controller:InteraccionCtrl,controllerAs:"it"}),InteraccionCtrl.$inject=["$rootScope"]}(),function(){"use strict";function MenuCtrl($rootScope,$state,$mdSidenav){function ir(ruta){$mdSidenav("left").isOpen()&&$mdSidenav("left").toggle(),$state.go(ruta)}var mn=this;mn.nombre=$rootScope.nombre,mn.ir=ir}angular.module("app").component("menu",{templateUrl:"views/menu.html",controller:MenuCtrl,controllerAs:"mn"}),MenuCtrl.$inject=["$rootScope","$state","$mdSidenav"]}(),function(){"use strict";function toolbarCtrl($rootScope,auth,$mdSidenav,$mdMedia,$window){function menuSwitch(menuId){$rootScope.atras?$window.history.back():$mdSidenav(menuId).toggle()}function configSwitch(menuId){$mdSidenav(menuId).toggle()}function logout(){auth.logout()}function verificaVista(){return $mdMedia("gt-md")?!!$rootScope.atras:!0}var tb=this;tb.configSwitch=configSwitch,tb.menuSwitch=menuSwitch,tb.logout=logout,tb.verificaVista=verificaVista,tb.nombre=$rootScope.nombre,tb.unidad=$rootScope.nombreUni}angular.module("app").component("toolbar",{templateUrl:"views/toolbar.html",controller:toolbarCtrl,controllerAs:"tb",bindings:{titulo:"=",menu:"=",url:"="}})}(),function(){"use strict";function ayudaCtrl($rootScope,$mdDialog){var au=this;$rootScope.tema="theme1",$rootScope.titulo="Ayuda",$rootScope.atras=!0,$rootScope.menu="arrow_back",au.video=function(ev,opcion){switch(opcion){case 1:var video="http://medicavial.net/mvred/videos/2_Conociendo_a_M%C3%A9dicaVial.mp4";break;case 2:var video="http://medicavial.net/mvred/videos/3.2_Registro_Web.mp4";break;case 3:var video="http://medicavial.net/mvred/videos/4_Autorizaciones_Especiales_y_Salida_de_Paquete.mp4"}$mdDialog.show({controller:"videoCtrl",controllerAs:"vi",templateUrl:"views/videos.html",locals:{video:video},parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0})},au.directorio=function(ev){$mdDialog.show({templateUrl:"views/directorio.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0,controller:function($scope,$mdDialog){$scope.cerrar=function(){$mdDialog.cancel()}}})}}function videoCtrl($mdDialog,video){var vi=this;vi.video=video,vi.options={loop:!0},vi.info={sources:[{src:video,type:"video/mp4"}]},vi.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("ayudaCtrl",ayudaCtrl).controller("videoCtrl",videoCtrl),ayudaCtrl.$inject=["$rootScope","$mdDialog"],videoCtrl.$inject=["$mdDialog","video"]}(),function(){"use strict";function busquedaCtrl($rootScope,registros,mensajes,publicfiles,$mdDialog){function buscar(){bs.consultando=!0,""!=bs.datos.folio&&(bs.busqueda="Folio MV: "+bs.datos.folio),""!=bs.datos.folioInt&&(bs.busqueda="Folio Interno: "+bs.datos.folioInt),""!=bs.datos.lesionado&&(bs.busqueda="Lesionado: "+bs.datos.lesionado),bs.consulta=registros.get(bs.datos,muestraDatos,error).$promise}function error(data){bs.consultando=!1,mensajes.alerta(mensajeError,"error","top right","error")}function inicio(){bs.datos={unidad:$rootScope.unidad,page:1,folio:"",folioInt:"",lesionado:"",limit:10,order:"-Exp_fecreg"},bs.paginacion=[10,20,30,40,50],bs.busqueda="Ultimos registros",bs.lesionado="",bs.folio="",bs.consultando=!1,bs.pageSelect=!0,buscar()}function muestraDatos(response){bs.registros=response.data,bs.limite=response.per_page,bs.pagina=response.current_page,bs.total=response.total,bs.consultando=!1}function ordenar(order){console.log("Scope Order: "+bs.order),console.log("Order: "+order)}function solicitaCancelacion(ev,folio){$mdDialog.show({controller:"cancelacionCtrl",controllerAs:"can",templateUrl:"views/cancelacion.html",locals:{folio:folio.Exp_folio},parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0}).then(function(estatus){console.log(estatus),"Cancelado"==estatus?folio.Exp_cancelado=1:"Solicitado"==estatus&&(folio.Exp_solCancela=1)})}var bs=this,mensajeError="Ocurrio un error de conexión intentelo nuevamente";$rootScope.titulo="Consulta de registros",$rootScope.atras=!0,$rootScope.menu="arrow_back",bs.inicio=inicio,bs.buscar=buscar,bs.ordenar=ordenar,bs.solicitaCancelacion=solicitaCancelacion,bs.detalle=[],bs.selected=[],bs.muestraDetalle=function(folio){console.log(folio)}}function busquedaGeneralCtrl($rootScope,registrosGlobales,mensajes,publicfiles,$mdDialog){function buscar(){bs.consultando=!0,""!=bs.datos.folio&&(bs.busqueda="Folio MV: "+bs.datos.folio),""!=bs.datos.folioInt&&(bs.busqueda="Folio Interno: "+bs.datos.folioInt),""!=bs.datos.lesionado&&(bs.busqueda="Lesionado: "+bs.datos.lesionado),bs.consulta=registrosGlobales.get(bs.datos,muestraDatos,error).$promise}function inicio(){bs.datos={unidad:$rootScope.unidad,page:1,folio:"",lesionado:"",limit:10,order:"-Exp_fecreg"},bs.paginacion=[10,20,30,40,50],bs.lesionado="",bs.folio="",bs.consultando=!1,bs.pageSelect=!0}function muestraDatos(response){bs.registros=response.data,bs.limite=response.per_page,bs.pagina=response.current_page,bs.total=response.total,bs.consultando=!1}function error(data){bs.consultando=!1,mensajes.alerta(mensajeError,"error","top right","error")}function ordenar(order){console.log("Scope Order: "+bs.order),console.log("Order: "+order)}function solicitaCancelacion(ev,folio){$mdDialog.show({controller:"cancelacionCtrl",controllerAs:"can",templateUrl:"views/cancelacion.html",locals:{folio:folio},parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0}).then(function(estatus){"canelado"==estatus?folio.Exp_cancelado=1:"solicitado"==estatus&&(folio.Exp_solCancela=1)})}var bs=this,mensajeError="Ocurrio un error de conexión intentelo nuevamente";$rootScope.titulo="Consulta de registros",$rootScope.atras=!0,$rootScope.menu="arrow_back",bs.inicio=inicio,bs.buscar=buscar,bs.ordenar=ordenar,bs.solicitaCancelacion=solicitaCancelacion,bs.detalle=[],bs.muestraDetalle=function(index,folio){bs.detalle[index]=!bs.detalle[index],bs.dato=folio}}angular.module("app").controller("busquedaCtrl",busquedaCtrl).controller("busquedaGeneralCtrl",busquedaGeneralCtrl),busquedaCtrl.$inject=["$rootScope","registros","mensajes","publicfiles","$mdDialog"],busquedaGeneralCtrl.$inject=["$rootScope","registrosGlobales","mensajes","publicfiles","$mdDialog"]}(),function(){"use strict";function cancelacionCtrl(busqueda,operacion,$rootScope,$mdDialog,folio,mensajes){function buscaMotivos(){busqueda.tiposCancelacion().success(function(data){can.motivos=data})}function cerrar(){$mdDialog.hide(!1)}function enviaSolicitud(){can.datosForm.$valid&&(can.guardando=!0,operacion.solicitaCancelacion(can.datos).success(function(data){mensajes.alerta(data.respuesta,"success","top right","done_all"),can.guardando=!1,$mdDialog.hide(data.estatus)}).error(function(data){mensajes.alerta("Ocurrio un error intentelo nuevamente","error","top right","error"),can.guardando=!1}))}function inicio(){can.guardando=!1,can.datos={usuario:$rootScope.id,folio:folio,motivoId:"",motivo:"",folioSus:"",observaciones:""}}var can=this;can.titulo="Solicitud de cancelación para el folio: "+folio,inicio(),buscaMotivos(),can.buscaMotivos=buscaMotivos,can.cerrar=cerrar,can.enviaSolicitud=enviaSolicitud,can.inicio=inicio}angular.module("app").controller("cancelacionCtrl",cancelacionCtrl),cancelacionCtrl.$inject=["busqueda","operacion","$rootScope","$mdDialog","folio","mensajes"]}(),function(){"use strict";function detalleCtrl($rootScope,datos,busqueda,mensajes,publicfiles,operacion,$mdDialog,$mdBottomSheet){function inicio(){dt.dato=datos.data,dt.imagenes=[],dt.subsecuencias=[],dt.rehabilitaciones=[],dt.codigo=publicfiles+"codigos/"+dt.dato.Exp_folio+".png",dt.isOpen=!1,dt.primera="",dt.seleccionado=!0,dt.seccion=!1,dt.detalle=!0,dt.consultaDetalle=!1,dt.tipo="",dt.porcentaje="",dt.atencionIcon="add",dt.iconPanel="expand_less",cargaDatosFolio(dt.dato.Exp_folio)}function muestraSeccion(page,icon,color){1==dt.dato.Exp_cancelado||1==dt.dato.Exp_solCancela?mensajes.alerta("El folio esta inactivo","error","top right","error"):(dt.page=page,dt.icon=icon,dt.bg=color,dt.seccion=!0,muestraPanel())}function cierraSeccion(page,icon){dt.seccion=!1,dt.detalle||muestraPanel()}function muestraPanel(){dt.detalle=!dt.detalle,1==dt.detalle?dt.iconPanel="expand_less":dt.iconPanel="expand_more"}function cargaDatosFolio(folio){busqueda.datosExpediente(folio).then(function(data){console.log(data),dt.tickets=data.tickets,dt.historial=data.historial,dt.autorizaciones=data.autorizaciones,dt.solicitudes=data.solicitudes,dt.primera=data.primera[0],dt.subsecuencias=data.subsecuencias,dt.rehabilitaciones=data.rehabilitaciones},function(error){dt.consultaDetalle=!1,muestraPanel(),mensajes.alerta("Error de Conexión vuelve a intentar","error","top right","error")})}function nuevaAtencion(){$mdBottomSheet.show({templateUrl:"views/opcionesGrid.html",controllerAs:"opt",clickOutsideToClose:!0,locals:{primera:dt.primera},controller:function(primera,$mdBottomSheet){var opt=this;console.log(primera),opt.items=[{icon:"filter_1",name:"Primera Atención",disabled:void 0!=primera},{icon:"add_to_queue",name:"Subsecuencia",disabled:void 0==primera},{icon:"directions_walk",name:"Rehabiliticación",disabled:void 0==primera}],opt.opcion=function(index){$mdBottomSheet.hide(index)}}}).then(function(opcion){0==opcion&&nuevaEt1(),1==opcion&&nuevaEt2(),2==opcion&&nuevaEt3()})}function nuevaEt1(){operacion.creaAtencion({folio:dt.folio,tipoAtn:1,consecutivo:1}).success(function(data){dt.primera=data}).error(function(error){mensajes.alerta("Error de Conexión vuelve a intentar","error","top right","error")})}function nuevaEt2(){operacion.creaAtencion({folio:dt.folio,tipoAtn:2,consecutivo:dt.subsecuencias.length+1}).success(function(data){dt.subsecuencias.push(data)}).error(function(error){mensajes.alerta("Error de Conexión vuelve a intentar","error","top right","error")})}function nuevaEt3(){operacion.creaAtencion({folio:dt.folio,tipoAtn:3,consecutivo:dt.rehabilitaciones.length+1}).success(function(data){dt.rehabilitaciones.push(data)}).error(function(error){mensajes.alerta("Error de Conexión vuelve a intentar","error","top right","error")})}function solicitudAutorizacion(imagen,ev){$mdDialog.show({templateUrl:"views/solicitudAutorizacion.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1,locals:{datos:dt.dato},fullscreen:!0,controller:"solicitudAutorizacionCtrl",controllerAs:"sol"}).then(function(solicitud){dt.solicitudes.push(solicitud)})}var dt=this;$rootScope.titulo="Detalle del Folio: "+datos.data.Exp_folio,$rootScope.atras=!0,$rootScope.menu="arrow_back",dt.folio=datos.data.Exp_folio,dt.producto=datos.data.Pro_clave,dt.secciones=[{nombre:"Atenciones",background:"blueGray400",icon:"folder_shared",col:"1",row:"1",size:"84",page:"views/atenciones.html"},{nombre:"Autorizaciones",background:"teal",icon:"beenhere",col:"1",row:"1",size:"84",page:"views/autorizaciones.html"},{nombre:"Problemas",background:"red400",icon:"warning",col:"1",row:"1",size:"84",page:"views/tickets.html"},{nombre:"Pagos",background:"green600",icon:"credit_card",col:"1",row:"1",size:"84",page:"views/pagosExpediente.html"},{nombre:"Linea de Tiempo",background:"purple400",icon:"toc",col:"1",row:"1",size:"84",page:"views/timeline.html"},{nombre:"Interaccion",background:"indigo400",icon:"chat",col:"1",row:"1",size:"84",page:"views/comunicacion.html"}],dt.cierraSeccion=cierraSeccion,dt.inicio=inicio,dt.muestraPanel=muestraPanel,dt.muestraSeccion=muestraSeccion,dt.nuevaAtencion=nuevaAtencion,dt.nuevaEt1=nuevaEt1,dt.nuevaEt2=nuevaEt2,dt.nuevaEt3=nuevaEt3,dt.solicitudAutorizacion=solicitudAutorizacion}function visorCtrl($scope,$mdDialog,imagen){$scope.archivo=imagen.archivo,$scope.imagen=imagen.clave,$scope.cerrar=function(){$mdDialog.cancel()},$scope.picture=function(){var extn=$scope.imagen.split(".").pop();return"jpg"==extn||"jpeg"==extn||"png"==extn||"PNG"==extn},$scope.file=function(){var extn=$scope.imagen.split(".").pop();return"pdf"==extn||"PDF"==extn},$scope.obtenerFrame=function(src){return"http://medicavial.net/registro/"+$scope.archivo+"/"+$scope.imagen}}angular.module("app").controller("detalleCtrl",detalleCtrl).controller("visorCtrl",visorCtrl),detalleCtrl.$inject=["$rootScope","datos","busqueda","mensajes","publicfiles","operacion","$mdDialog","$mdBottomSheet"],visorCtrl.$inject=["$scope","$mdDialog","imagen"]}(),function(){"use strict";function documentosCtrl($rootScope,$mdDialog,datos){function nuevo(ev){$mdDialog.show({controller:"altaDocumentoCtrl",controllerAs:"ad",templateUrl:"views/altaDocumento.html",locals:{datos:{tiposDocumento:dc.tiposDocumento,tiposAtencion:dc.tiposAtencion,productos:dc.productos}},parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0})}var dc=this;dc.tiposDocumento=datos[0].data,dc.tiposAtencion=datos[1].data,dc.productos=datos[2].data,$rootScope.titulo="Atenciones - Documentos",$rootScope.atras=!0,$rootScope.menu="arrow_back",dc.nuevo=nuevo}function altaDocumentoCtrl($mdDialog,datos,operacion,mensajes,busqueda,filtro){function toggle(item,list){var idx=list.indexOf(item);idx>-1?list.splice(idx,1):list.push(item)}function exists(item,list){return list.indexOf(item)>-1}function inicio(){ad.index=0,ad.guardado=!1,ad.guardando=!1,ad.datos={producto:"",atencion:"",documentos:[]}}function cancel(){$mdDialog.hide()}function guardar(){ad.guardando=!0,operacion.guardaDocumento(ad.datos).success(function(data){ad.guardado=!0,ad.guardando=!1,mensajes.alerta(data.flash,"success","top right","done_all"),inicio()}).error(function(error){ad.guardando=!1,mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")})}function siguiente(){ad.datos.producto&&0==ad.index?ad.index++:ad.datos.atencion&&1==ad.index&&verificaDocumentos()}function verificaDocumentos(){busqueda.productoAtencionDocumentos(ad.datos).then(function(respuesta){var documentosSeleccionados=respuesta.data;agregarExistencias(documentosSeleccionados),ad.index++},function(error){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error")})}function agregarExistencias(datos){angular.forEach(datos,function(dato,clave){console.log(dato.TID_clave);var documento=filtro.consulta(ad.tiposDocumento,dato.TID_clave);ad.datos.documentos.push(documento)})}var ad=this;ad.productos=datos.productos,ad.tiposDocumento=datos.tiposDocumento,ad.tiposAtencion=datos.tiposAtencion,ad.cancel=cancel,ad.inicio=inicio,ad.guardar=guardar,ad.toggle=toggle,ad.exists=exists,ad.siguiente=siguiente,inicio()}angular.module("app").controller("documentosCtrl",documentosCtrl).controller("altaDocumentoCtrl",altaDocumentoCtrl),documentosCtrl.$inject=["$rootScope","$mdDialog","datos"],altaDocumentoCtrl.$inject=["$mdDialog","datos","operacion","mensajes","busqueda","filtro"]}(),function(){"use strict";function estadisticasCtrl($rootScope,$mdDialog,datos){var et=this;$rootScope.titulo="Estadisticas",$rootScope.atras=!0,$rootScope.menu="arrow_back",et.datos=datos[2].data,et.meses={data:datos[1].data,type:"serial",categoryField:"MES",rotate:!1,legend:{enabled:!1},chartScrollbar:{enabled:!1},graphs:[{type:"column",title:"Cantidad",valueField:"Cantidad",fillAlphas:.9,balloonText:"[[category]]<br><b>Atenciones: [[value]]</b>"}]},et.semanas={data:datos[0].data,type:"serial",categoryField:"Semana",rotate:!1,legend:{enabled:!1},chartScrollbar:{enabled:!1},graphs:[{type:"column",title:"Cantidad",valueField:"Cantidad",fillAlphas:.9,balloonText:"[[category]]<br><b>Atenciones: [[value]]</b>"}]}}function estadisticaCtrl($rootScope,datos,$stateParams){console.log(datos);var es=this;es.datos=datos.data,es.tipo=$stateParams.tipo,$rootScope.atras=!0,$rootScope.menu="arrow_back","documentos"==es.tipo?$rootScope.titulo="Detalle de Atenciones Sin Documentos":"autorizar"==es.tipo?$rootScope.titulo="Detalle de Atenciones Con Documentos Sin Autorizar":"factura"==es.tipo?$rootScope.titulo="Detalle de Atenciones Autorizadas Sin Facturar":"rechazo"==es.tipo&&($rootScope.titulo="Detalle de Atenciones Rechazadas")}angular.module("app").controller("estadisticasCtrl",estadisticasCtrl).controller("estadisticaCtrl",estadisticaCtrl),estadisticasCtrl.$inject=["$rootScope","$mdDialog","datos"],estadisticaCtrl.$inject=["$rootScope","datos","$stateParams"]}(),function(){"use strict";function formatosCtrl($rootScope,$mdDialog){var au=this;$rootScope.tema="theme1",$rootScope.titulo="Fomatos",$rootScope.atras=!0,$rootScope.menu="arrow_back",au.video=function(ev,opcion){switch(opcion){case 1:var video="http://medicavial.net/mvred/videos/3_Numero_de%20faltas_y_retardos%20LIC_MARIANA_SANCHEZ.mp4";break;case 2:var video="http://medicavial.net/mvred/videos/5_Expedientes_completos_ING_ALFREDO_GUTIERREZ.mp4";break;case 3:var video="http://medicavial.net/mvred/videos/7_Tiempo_de_espera_ING_ALFREDO_GUTIERREZ.mp4"}$mdDialog.show({controller:"archivoCtrl",controllerAs:"vi",templateUrl:"views/videos.html",locals:{video:video},parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0})},au.directorio=function(ev){$mdDialog.show({templateUrl:"views/directorio.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0,fullscreen:!0,controller:function($scope,$mdDialog){$scope.cerrar=function(){$mdDialog.cancel()}}})}}function archivoCtrl($mdDialog,video){var vi=this;vi.video=video,vi.options={loop:!0},vi.info={sources:[{src:video,type:"video/mp4"}]},vi.cancel=function(){$mdDialog.hide()}}angular.module("app").controller("formatosCtrl",formatosCtrl).controller("archivoCtrl",archivoCtrl),formatosCtrl.$inject=["$rootScope","$mdDialog"],archivoCtrl.$inject=["$mdDialog","video"]}(),function(){"use strict";function homeCtrl($rootScope){var hm=this;$rootScope.tema="theme1",$rootScope.titulo="Bienvenido",hm.secciones=[{nombre:"Registro",background:"blueG",icon:"assignment",col:"2",row:"1",size:"104",permiso:!0,url:"index.registro"},{nombre:"Formatos",background:"greenG",icon:"insert_drive_file",col:"2",row:"1",size:"84",permiso:!0,url:"index.formatos"},{nombre:"Ayuda",background:"orangeG",icon:"help",col:"2",row:"1",size:"84",permiso:!0,url:"index.ayuda"},{nombre:"Expediente",background:"redG",icon:"search",col:"2",row:"1",size:"84",permiso:!0,url:"index.busqueda"},{nombre:"Conciliación",background:"grayG",icon:"attach_money",col:"1",row:"1",size:"84",permiso:!0,url:"index.registro"},{nombre:"Estadistica",background:"yellowG",icon:"show_chart",col:"1",row:"1",size:"84",permiso:!0,url:"index.estadisticas"}],hm.seccionesAdmin=[{nombre:"Consulta General",background:"bgm-brown",icon:"search",col:"2",row:"1",size:"84",permiso:!0,url:"index.busquedaGeneral"},{nombre:"Alta Documentos",background:"bgm-indigo",icon:"style",col:"1",row:"1",size:"84",permiso:!0,url:"index.documentos"},{nombre:"Alta Requisitos",background:"bgm-deeppurple",icon:"featured_play_list",col:"1",row:"1",size:"84",permiso:!0,url:"index.requisitos"}]}angular.module("app").controller("homeCtrl",homeCtrl),homeCtrl.$inject=["$rootScope"]}(),function(){"use strict";function loginCtrl(auth,$rootScope){var sesion=this;$rootScope.cargando=!1,$rootScope.tema="theme1",sesion.inicio=function(){sesion.datos={usuario:"",psw:"",guardar:!1}},sesion.login=function(){sesion.loginForm.$valid&&($rootScope.cargando=!0,auth.login(sesion.datos))}}angular.module("app").controller("loginCtrl",loginCtrl),loginCtrl.$inject=["auth","$rootScope"]}(),function(){"use strict";function registroCtrl($rootScope,datos,busqueda,$mdDialog,$q,$filter,operacion,mensajes,publicfiles,$mdpDatePicker,ayuda){function agregaTelefono(ev){$mdDialog.show({controller:"telefonoCtrl",controllerAs:"tel",templateUrl:"views/agregaTelefono.html",parent:angular.element(document.body),targetEvent:ev,locals:{tipos:vm.tipos,telefonos:vm.telefonos},clickOutsideToClose:!1,fullscreen:!0}).then(function(telefonos){vm.telefonos=telefonos})}function buscaAjustador(query){var q=$q.defer(),response=query?$filter("filter")(vm.ajustadores,query):vm.ajustadores;return q.resolve(response),q.promise}function confirmaProducto(producto){vm.errorInfo?(mensajes.alerta(error,"error","top right","alert"),consultaInfo()):(vm.tabActual=2,vm.step1block=!0,vm.step2block=!0,vm.step3block=!1,vm.imagenProducto=producto.Pro_img,vm.datos.producto=producto.Pro_clave,$rootScope.modoGuiado&&ayuda.registro1("Ayuda para llenar formato de registro"))}function consultaInfo(){var tipos=busqueda.tipos(),riesgos=busqueda.riesgos(),ajustadores=busqueda.ajustadores();$q.all([tipos,riesgos,ajustadores]).then(function(data){vm.tipos=data[0].data,vm.riesgos=data[1].data,vm.ajustadores=data[2].data},function(error){vm.errorInfo=!0})}function detalleAjustador(ajustador){void 0!=ajustador?(vm.datoSiniestro.ajustador=ajustador.AJU_nombre,vm.datoSiniestro.telAjustador=ajustador.AJU_tel,vm.datoSiniestro.cveAjustador=ajustador.AJU_clavease,vm.datoSiniestro.cveAjustadorMv=ajustador.AJU_claveint,
vm.ajustadorExiste=!0):(vm.ajustadorExiste=!1,vm.datoSiniestro.telAjustador="",vm.datoSiniestro.cveAjustador="",vm.datoSiniestro.cveAjustadorMv="")}function guardaPaciente(){vm.registroForm.$valid&&(vm.guardando=!0,operacion.registroPaciente(vm.datos).success(function(data){vm.guardando=!1,vm.step4block=!1,vm.tabActual=3,vm.step3block=!0,vm.datoSiniestro.folio=data.folio,vm.imagenFolio=publicfiles+data.codigo,vm.registro=data.registro,$rootScope.modoGuiado&&ayuda.registro1("Ayuda para guardar datos de siniestro"),mensajes.alerta(data.respuesta,"success","top right","done_all")}).error(function(error){vm.guardando=!1,error?mensajes.alerta(error,"error","top right","done_all"):mensajes.alerta(mensajeError,"error","top right","done_all")}))}function guardaSiniestro(){vm.siniestroForm.$valid&&(vm.datoSiniestro.ajustador.toUpperCase(),vm.guardando=!0,operacion.registroSiniestro(vm.datoSiniestro).success(function(data){vm.guardando=!1,vm.step5block=!1,vm.tabActual=4,vm.step4block=!0,mensajes.alerta(data.respuesta,"success","top right","done_all")}).error(function(error){vm.guardando=!1,mensajes.alerta(mensajeError,"error","top right","done_all")}))}function inicio(){vm.step1block=!1,vm.step2block=!0,vm.step3block=!0,vm.step4block=!0,vm.step5block=!0,vm.consultando=!1,vm.guardando=!1,vm.ajustadorExiste=!1,vm.errorInfo=!1,vm.tabActual=0,vm.telefonos=[],vm.productos=[],vm.imagenCliente="",vm.imagenProducto="",vm.imagenFolio="",vm.compania="",vm.registro="",vm.vigencia=0,vm.datos={unidad:$rootScope.unidad,localidad:$rootScope.localidad,usuario:$rootScope.id,cliente:"",producto:"",telefono:"",telefonos:vm.telefonos,correo:"",nombre:"",apaterno:"",amaterno:"",folioInterno:"",fechaNac:new Date(vm.fecha)},vm.datoSiniestro={folio:"",tipotel:"",poliza:"",localidad:$rootScope.localidad,cliente:vm.datos.cliente,folioElec:"",inciso:"",siniestro:"",reporte:"",orden:"",bitacora:"",ilejible:!1,ajustador:"",ajustadorId:"",cveAjustador:"",cveAjustadorMv:"",telAjustador:"",bitacora:"",observaciones:"",deducible:!1,reporte:"",observacionesDeducible:"",fechaAtencion:"",fechaExp:"",extemporaneo:!1,motivoEx:""},consultaInfo(),$rootScope.modoGuiado&&ayuda.registro1("Ayuda para seleccionar el cliente")}function resetForms(){vm.registroForm.$setPristine(),vm.siniestroForm.$setPristine(),inicio()}function verificaObligatorio(){return""==vm.datoSiniestro.siniestro&&""==vm.datoSiniestro.bitacora&&""==vm.datoSiniestro.reporte}function verificaProducto(cliente){vm.productos=[],vm.consultando=!0,vm.tabActual=1,vm.step2block=!1,vm.errorInfo&&consultaInfo(),busqueda.productosCliente(cliente.Cia_clave,vm.datos.localidad).success(function(data){if(vm.productos=data,vm.consultando=!1,vm.datos.cliente=cliente.Cia_clave,vm.imagenCliente=cliente.Cia_logo,vm.compania=cliente.Cia_nombrecorto,vm.vigencia=cliente.Cia_vigenciaPase,1==vm.productos.length){var producto=vm.productos[0];confirmaProducto(producto)}else $rootScope.modoGuiado&&ayuda.registro1("Ayuda para selección de producto")})}function verificaVigencia(){var fecha1=moment(),fecha2=moment(vm.datoSiniestro.fechaExp),dias=fecha1.diff(fecha2,"days");console.log(dias),console.log(vm.vigencia),dias>vm.vigencia&&mensajes.alerta("El pase esta vencido","error","top right","report_problem")}var vm=this;vm.fecha=moment().subtract(25,"year");var mensajeError=(new Date(vm.fecha),"Ocurrio un error al guardar intentelo nuevamente");$rootScope.titulo="Registro de Paciente",$rootScope.atras=!0,$rootScope.menu="arrow_back",vm.clientes=datos.clientes,vm.paso1="views/registroPaso1.html",vm.paso2="views/registroPaso2.html",vm.paso3="views/registroPaso3.html",vm.paso4="views/registroPaso4.html",vm.inicio=inicio,vm.agregaTelefono=agregaTelefono,vm.buscaAjustador=buscaAjustador,vm.confirmaProducto=confirmaProducto,vm.guardaPaciente=guardaPaciente,vm.guardaSiniestro=guardaSiniestro,vm.verificaProducto=verificaProducto,vm.detalleAjustador=detalleAjustador,vm.resetForms=resetForms,vm.consultaInfo=consultaInfo,vm.verificaObligatorio=verificaObligatorio,vm.verificaVigencia=verificaVigencia}function telefonoCtrl($mdDialog,tipos,telefonos,mensajes){function inicio(){tel.telefono="",tel.tipoTel=""}function agregaTelefono(){tel.telefonos.push({telefono:tel.telefono,tipo:tel.tipoTel.TT_clave,nombre:tel.tipoTel.TT_tipotelefono}),inicio()}function ingresa(){""==tel.telefono?$mdDialog.hide(tel.telefonos):confirm("No has agregado el numero que acabas de escribir ¿deseas salir?")&&$mdDialog.hide(tel.telefonos)}var tel=this;tel.tipos=tipos,tel.telefonos=telefonos,inicio(),tel.inicio=inicio,tel.agregaTelefono=agregaTelefono,tel.ingresa=ingresa}angular.module("app").controller("registroCtrl",registroCtrl).controller("telefonoCtrl",telefonoCtrl),registroCtrl.$inject=["$rootScope","datos","busqueda","$mdDialog","$q","$filter","operacion","mensajes","publicfiles","$mdpDatePicker","ayuda"],telefonoCtrl.$inject=["$mdDialog","tipos","telefonos","mensajes"]}(),function(){"use strict";function solicitudAutorizacionCtrl(datos,operacion,mensajes,$rootScope,$mdDialog){function cancelar(){$mdDialog.cancel()}function inicio(){sol.files=[],sol.documentos=[],sol.nombredoc="",sol.mensaje="",sol.clavesolicitud="",sol.folio=datos.Exp_folio,sol.tabActual=0,sol.step1block=!1,sol.step2block=!0,sol.step3block=!0,sol.step4block=!0,sol.step5block=!0,sol.paso1="views/solicitudPaso1.html",sol.paso2="views/solicitudPaso2.html",sol.datos={usuario:$rootScope.id,folio:datos.Exp_folio,lesionado:datos.Exp_completo,tipo:"",cliente:datos.Cia_clave,clientenombre:datos.Cia_nombrecorto,interconsulta:{tipo:"",embarazo:"",controlgineco:"NO",semanas:4,dolorabdominal:"NO",frecuencia:"",movimientosfetales:"",observaciones:""},estudio:{tipo:"",detalle:""},rehabilitacion:{dolor:0,rehabilitaciones:0,mejora:0},suministro:{detalle:""},informacion:{notamedica:!1,rx:!1,resultados:!1,detalle:""},salidapaquete:{detalle:""},problemadocumental:{pase:!1,identificacion:!1,detalle:""},diagnostico:"",justificacion:"",soporte:sol.documentos},sol.ultimo="Lesionado",sol.index=0,sol.buscar=!1,sol.tiposDocumentos=datos.data}function mensaje(){sol.tipo=!1;var valor=sol.datos.tipo;switch(valor){case"4":sol.mensajetipo="Te recordamos que dentro del paquete pactado está incluida la atención inicial y subsecuente por médico traumatólogo o urgenciólogo. Así como también la consulta de valoración por médico de cualquier otra especialidad, en caso de requerir tratamiento de una especialidad distinta a Traumatología y Ortopedia por favor solicita una salida de paquete.",sol.tipo=!0;break;case"3":sol.mensajetipo="Te recordamos que los Rx están conveniados dentro del paquete.",sol.tipo=!0;break;case"1":sol.mensajetipo="Según su lesión y siguiendo el criterio y las indicaciones del médico tratante es recomendable proporcionarle al lesionado ejercicio para realizar por su cuenta. Aunado a lo anterior les recordamos que las primeras cinco sesiones de rehabilitación están previamente convenidas dentro del paquete.",sol.tipo=!0;break;case"9":sol.mensajetipo="Pendiente",sol.tipo=!0;break;case"11":sol.mensajetipo="La coordinación médica es quien dictaminará, en su caso, la entrega o rechazo de informes médicos y estudios a los pacientes, de acuerdo a las indicaciones de cada compañía de seguros.",sol.tipo=!0;break;case"21":sol.mensajetipo="Se debe solicitar salida de paquete cuando el tratamiento amerite periodo de tiempo en corta estancia, observación, hospitalización o procedimientos quirúrgicos, terapia intermedia o intensiva.",sol.tipo=!0;break;case"2":sol.mensajetipo="Pendiente",sol.tipo=!0;break;default:sol.mensajetipo="",sol.tipo=!1}}function siguiente(){0==sol.tabActual&&""!=sol.datos.tipo?(sol.step2block=!1,sol.tabActual++):1==sol.tabActual?(sol.step3block=!1,sol.tabActual++):2==sol.tabActual?(sol.step4block=!1,sol.tabActual++):3==sol.tabActual&&(sol.step5block=!1,sol.tabActual++)}function solicitar(){sol.guardando=!0,operacion.ingresaSolicitud(sol.datos).success(function(data){sol.guardando=!1,mensajes.alerta("Datos Guardados Correctamente","success","top right","done_all"),$mdDialog.hide(data)}).error(function(error){mensajes.alerta("Ocurrio un error intentalo nuevamente","error","top right","error"),sol.guardando=!1})}function subirDigitales(file,ev){files.length>0&&(atn.subiendoImagen=!0,operacion.subirImagenesSolicitud(files).then(function(datos){atn.imagenes.push(datos),mensajes.alerta("Imagen subida correctamente","success","top right","done_all"),atn.porcentaje="",atn.subiendoImagen=!1,atn.tipo="",atn.files=[]},function(error){mensajes.alerta(error,"error","top right","error"),atn.porcentaje="",atn.subiendoImagen=!1},function(porcentaje){atn.porcentaje=porcentaje}))}function eliminaImagen(index){sol.documentos.splice(index,1)}var sol=this;sol.titulo="Solicitud de Autorización",sol.inicio=inicio,sol.mensaje=mensaje,sol.siguiente=siguiente,sol.subirDigitales=subirDigitales,sol.eliminaImagen=eliminaImagen,sol.solicitar=solicitar,sol.cancelar=cancelar}angular.module("app").controller("solicitudAutorizacionCtrl",solicitudAutorizacionCtrl),solicitudAutorizacionCtrl.$inject=["datos","operacion","mensajes","$rootScope","$mdDialog"]}(),function(){"use strict";angular.module("app").directive("dragEnd",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){var functionToCall=scope.$eval(attrs.dragEnd);element.on("$md.dragend",function(){functionToCall(modelCtrl.$viewValue)}),element.on("click",function(){functionToCall(modelCtrl.$viewValue)})}}})}(),function(){"use strict";angular.module("app").directive("backButton",["$window",function($window){return{restrict:"A",link:function(scope,elem){elem.bind("click",function(){$window.history.back()})}}}])}(),function(){"use strict";angular.module("app").directive("bloqueo",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){var caracter=scope.$eval(attrs.bloqueo);element.on("keydown",function(e){e.keyCode==caracter&&e.preventDefault()})}}})}(),function(){"use strict";angular.module("app").directive("expandColor",function($animate){function link(scope,element,attrs){var color=attrs.expandColor;console.log(color),element.on("click",function(){var iDiv=document.createElement("div");iDiv.className="box",element.append(iDiv),angular.element(iDiv).addClass(color),angular.element(iDiv).addClass("active")})}return{link:link}})}(),function(){"use strict";angular.module("app").directive("folio",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){var rellenaFolio=function(folio){if(""!==folio){var totalletras=folio.length,letras=folio.substr(0,4),numeros=folio.substr(4,totalletras);if(letras.length<4)for(var faltantes=4-letras.length,i=0;faltantes>i;i++){letras.charAt(i);letras+="0"}if(numeros.length<6)for(var faltantes=6-numeros.length,i=0;faltantes>i;i++)numeros="0"+numeros;return folio=letras+numeros}return folio};element.on("blur",function(){if(modelCtrl.$modelValue.length>3){var nuevo=rellenaFolio(modelCtrl.$modelValue);modelCtrl.$setViewValue(nuevo.toUpperCase()),modelCtrl.$render(),scope.$apply()}}),element.on("keydown",function(e){if(modelCtrl.$modelValue){var cantidad=modelCtrl.$modelValue.length;if(4>cantidad)e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105?e.preventDefault():element.css("text-transform","uppercase");else if(cantidad>3&&10>cantidad){if(e.keyCode>=65&&e.keyCode<=90)e.preventDefault();else if(13==e.keyCode){var nuevo=rellenaFolio(modelCtrl.$modelValue);modelCtrl.$setViewValue(nuevo.toUpperCase()),modelCtrl.$render(),scope.$apply()}}else(e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105)&&e.preventDefault()}})}}})}(),function(){"use strict";angular.module("app").directive("imageonload",function(){return{restrict:"A",link:function(scope,element){element.on("load",function(){element.removeClass("spinner-hide"),element.addClass("spinner-show"),element.parent().find("span").remove()}),scope.$watch("ngSrc",function(){element.addClass("spinner-hide")})}}}).directive("ngMouseWheelUp",function(){return function(scope,element,attrs){element.bind("DOMMouseScroll mousewheel onmousewheel",function(event){var event=window.event||event,delta=Math.max(-1,Math.min(1,event.wheelDelta||-event.detail));delta>0&&(scope.$apply(function(){scope.$eval(attrs.ngMouseWheelUp)}),event.returnValue=!1,event.preventDefault&&event.preventDefault())})}}).directive("ngMouseWheelDown",function(){return function(scope,element,attrs){element.bind("DOMMouseScroll mousewheel onmousewheel",function(event){var event=window.event||event,delta=Math.max(-1,Math.min(1,event.wheelDelta||-event.detail));0>delta&&(scope.$apply(function(){scope.$eval(attrs.ngMouseWheelDown)}),event.returnValue=!1,event.preventDefault&&event.preventDefault())})}})}(),function(){"use strict";angular.module("app").directive("mayusculas",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){element.bind("blur",function(){var inputValue=modelCtrl.$modelValue;if(inputValue){var capitalized=inputValue.toUpperCase();capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render())}}),element.css("text-transform","uppercase")}}})}(),function(){"use strict";angular.module("app").directive("dinero",function(){function link(scope,el,attrs,ngModelCtrl){function round(num){var d=Math.pow(10,precision);return Math.round(num*d)/d}function formatPrecision(value){return parseFloat(value).toFixed(precision)}function formatViewValue(value){return ngModelCtrl.$isEmpty(value)?"":""+value}var lastValidValue,min=parseFloat(attrs.min||0),precision=parseFloat(attrs.precision||2);ngModelCtrl.$parsers.push(function(value){0===value.indexOf(".")&&(value="0"+value),0===value.indexOf("-")&&(min>=0?(value=null,ngModelCtrl.$setViewValue(""),ngModelCtrl.$render()):"-"===value&&(value=""));var empty=ngModelCtrl.$isEmpty(value);return empty||NUMBER_REGEXP.test(value)?lastValidValue=""===value?null:empty?value:parseFloat(value):(ngModelCtrl.$setViewValue(formatViewValue(lastValidValue)),ngModelCtrl.$render()),ngModelCtrl.$setValidity("number",!0),lastValidValue}),ngModelCtrl.$formatters.push(formatViewValue);var minValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&min>value?void ngModelCtrl.$setValidity("min",!1):(ngModelCtrl.$setValidity("min",!0),value)};if(ngModelCtrl.$parsers.push(minValidator),ngModelCtrl.$formatters.push(minValidator),attrs.max){var max=parseFloat(attrs.max),maxValidator=function(value){return!ngModelCtrl.$isEmpty(value)&&value>max?void ngModelCtrl.$setValidity("max",!1):(ngModelCtrl.$setValidity("max",!0),value)};ngModelCtrl.$parsers.push(maxValidator),ngModelCtrl.$formatters.push(maxValidator)}precision>-1&&(ngModelCtrl.$parsers.push(function(value){return value?round(value):value}),ngModelCtrl.$formatters.push(function(value){return value?formatPrecision(value):value})),el.bind("blur",function(){var value=ngModelCtrl.$modelValue;value&&(ngModelCtrl.$viewValue=formatPrecision(value),ngModelCtrl.$render())})}var NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:link}})}(),function(){"use strict";angular.module("app").directive("ngMorphingModal",function(){var randLetter=String.fromCharCode(65+Math.floor(26*Math.random()));randLetter+Date.now();return{replace:!0,restrict:"AE",scope:{contentSelector:"@"},link:function(scope,element,attributes){new MorphingModal({selectorId:'[data-type="modal-trigger"]',selectorObj:$('[data-type="modal-trigger"]'),contentSelector:scope.contentSelector,onAfterClose:null,onAfterOpen:function(){}})},templateUrl:"../js/td-modal.html"}})}(),function(){"use strict";angular.module("app").directive("numero",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,modelCtrl){element.on("keydown",function(e){(e.keyCode>=65&&e.keyCode<=90||110==e.keyCode||190==e.keyCode||189==e.keyCode)&&e.preventDefault()})}}})}(),function(){"use strict";angular.module("app").directive("portada",["$window",function($window){return{restrict:"A",link:function(scope,elem){elem.bind("click",function(){$window.history.back()})}}}])}(),function(){"use strict";function auth($http,api,$state,webStorage,$rootScope,mensajes){return{login:function(credenciales){$http.post(api+"login",credenciales).success(function(data){webStorage.local.clear(),$rootScope.cargando=!1,webStorage.session.add("username",data.Usu_login),webStorage.session.add("nombre",data.Usu_nombre),webStorage.session.add("id",data.Usu_login),webStorage.session.add("localidad",data.LOC_claveint),webStorage.session.add("unidad",data.Uni_clave),webStorage.session.add("nombreUni",data.Uni_nombrecorto),webStorage.session.add("permisos",JSON.stringify(data)),$rootScope.username=webStorage.session.get("username"),$rootScope.nombre=webStorage.session.get("nombre"),$rootScope.id=webStorage.session.get("id"),$rootScope.localidad=webStorage.session.get("localidad"),$rootScope.unidad=webStorage.session.get("unidad"),$rootScope.nombreUni=webStorage.session.get("nombreUni"),$rootScope.permisos=JSON.parse(webStorage.session.get("permisos")),credenciales.guardar&&webStorage.local.add("usuario",JSON.stringify(data)),$state.go("index.home")}).error(function(data){data?mensajes.alerta(data.flash,"error center-dialog","top","error"):mensajes.alerta("Error en conexión intentalo nuevamente","error center-dialog","top","error"),$rootScope.cargando=!1})},logout:function(){webStorage.session.clear(),$http.get(api+"logout"),$state.go("login")},verify:function(api){}}}angular.module("app").factory("auth",auth)}(),function(){"use strict";function ayuda($mdDialog){function registro1(titulo){$mdDialog.show({templateUrl:"views/ayudaDialog.html",controllerAs:"vm",controller:function($mdDialog){var vm=this;vm.titulo=titulo,vm.cancelar=function(){$mdDialog.cancel()}},parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:!0})}var servicio={registro1:registro1};return servicio}angular.module("app").factory("ayuda",ayuda)}(),function(){"use strict";function busqueda($http,$rootScope,api,$q,$filter){function serializeObj(obj){var result=[];for(var property in obj)result.push(encodeURIComponent(property)+"="+encodeURIComponent(obj[property]));return result.join("&")}function ajustadores(){return $http.get(api+"busqueda/ajustadores/"+$rootScope.localidad,{timeout:1e4})}function productoAtencionDocumentos(datos){var parametros=serializeObj(datos);return $http.get(api+"busqueda/productoAtencionDocumentos?"+parametros,{timeout:1e4})}function clientes(){return $http.get(api+"busqueda/clientes",{timeout:1e4})}function datosExpediente(folio){var promesa=$q.defer(),atenciones=$http.get(api+"busqueda/atenciones/"+folio,{timeout:1e4}),historial=$http.get(api+"busqueda/historial/"+folio,{timeout:1e4}),autorizaciones=$http.get(api+"busqueda/autorizaciones/"+folio,{timeout:1e4}),tickets=$http.get(api+"busqueda/tickets/"+folio,{timeout:1e4}),solicitudes=$http.get(api+"busqueda/solicitudes/"+folio,{timeout:1e4});return $q.all([tickets,historial,autorizaciones,atenciones,solicitudes]).then(function(data){var atenciones=data[3].data,primera=$filter("filter")(atenciones,{TIA_clave:1}),subsecuencias=$filter("filter")(atenciones,{TIA_clave:2}),rehabilitaciones=$filter("filter")(atenciones,{TIA_clave:3}),datos={tickets:data[0].data,historial:data[1].data,autorizaciones:data[2].data,solicitudes:data[4].data,primera:primera,subsecuencias:subsecuencias,rehabilitaciones:rehabilitaciones};promesa.resolve(datos)},function(error){promesa.reject("error en conexión")}),promesa.promise}function detalleAtencion(atencion){var promesa=$q.defer(),lesion=tipoLesion(),detalle=$http.get(api+"busqueda/detalleAtencion/"+atencion);return $q.all([detalle,lesion]).then(function(datos){var datos={tipos:datos[0].data.tipos,imagenes:datos[0].data.imagenes,info:datos[0].data.info,requisitos:datos[0].data.requisitos,anotaciones:datos[0].data.anotaciones,lesiones:datos[1].data};promesa.resolve(datos)},function(error){promesa.reject("error en conexión")}),promesa.promise}function detalleFolio(folio){return $http.get(api+"busqueda/detalleFolio/"+folio,{timeout:1e4})}function documentosAtencion(atencion,producto){return $http.get(api+"busqueda/documentos/"+atencion+"/"+producto,{timeout:1e4})}function documentoSolicitud(){return $http.get(api+"busqueda/documentoSolicitud",{timeout:1e4})}function lesionCodificada(lesion){return $http.get(api+"busqueda/lesionCodificada/"+lesion,{timeout:1e4})}function lesionMV(tipo){return $http.get(api+"busqueda/lesionMV/"+tipo,{timeout:1e4})}function productos(){return $http.get(api+"busqueda/productos",{timeout:1e4})}function productosCliente(cliente,localidad){return $http.get(api+"busqueda/productos/"+cliente+"/"+localidad,{timeout:1e4})}function riesgos(){return $http.get(api+"busqueda/riesgos",{timeout:1e4})}function registros(datos){console.log(datos);var promesa=$q.defer(),parametros="unidad="+$rootScope.unidad;void 0!==datos&&(datos.folio&&(parametros=parametros+"&folio="+datos.folio),datos.lesionado&&(parametros=parametros+"&lesionado="+datos.lesionado));var consulta=$http.get(api+"busqueda/registros?"+parametros,{timeout:1e4});return $q.when(consulta).then(function(datos){console.log(datos),datos.data.length>0?promesa.resolve(datos.data):promesa.reject("No se encontraron coincidencias.")},function(error){promesa.reject("Ocurrio un error intentelo nuevamente")}),promesa.promise}function documentosAtencion(producto,atencion){return $http.get(api+"busqueda/documentos/"+producto+"/"+atencion,{timeout:1e4})}function tipos(){return $http.get(api+"busqueda/tiposTelefono",{timeout:1e4})}function tiposCancelacion(){return $http.get(api+"busqueda/tiposCancelacion",{timeout:1e4})}function tiposDocumento(){return $http.get(api+"busqueda/tiposDocumento",{timeout:1e4})}function tiposAtencion(){return $http.get(api+"busqueda/tiposAtencion",{timeout:1e4})}function tipoLesion(){return $http.get(api+"busqueda/tipoLesion",{timeout:1e4})}var servicio={ajustadores:ajustadores,clientes:clientes,datosExpediente:datosExpediente,detalleAtencion:detalleAtencion,detalleFolio:detalleFolio,documentosAtencion:documentosAtencion,documentoSolicitud:documentoSolicitud,lesionCodificada:lesionCodificada,lesionMV:lesionMV,productoAtencionDocumentos:productoAtencionDocumentos,productos:productos,productosCliente:productosCliente,registros:registros,riesgos:riesgos,tipos:tipos,tiposCancelacion:tiposCancelacion,tiposDocumento:tiposDocumento,tiposAtencion:tiposAtencion,tipoLesion:tipoLesion};return servicio}angular.module("app").factory("busqueda",busqueda)}(),function(){"use strict";function filtro($filter){function consulta(listado,valor){return $filter("filter")(listado,{TID_claveint:valor},!0)}var servicio={consulta:consulta};return servicio}angular.module("app").factory("filtro",filtro)}(),function(){"use strict";function mensajes($mdToast,$mdDialog,$q){return{confirmacion:function(titulo,mensaje,ev){var confirm=$mdDialog.confirm().title(titulo).content(mensaje).ariaLabel("Confirmación").targetEvent(ev).ok("SI").cancel("NO");$mdDialog.show(confirm).then(function(){return!0},function(){return!1})},notifica:function(mensaje,descripcion,ev){$mdDialog.show($mdDialog.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title(mensaje).content(descripcion).ariaLabel(mensaje).ok("OK").targetEvent(ev))},alerta:function(mensaje,tipo,posicion,icono){$mdToast.show({template:'<md-toast class="'+tipo+'"> <md-icon class="padding-right"> <ng-md-icon icon="'+icono+'" style="fill:white"></ng-md-icon></md-icon> <span flex>'+mensaje+"</span></md-toast>",hideDelay:4e3,position:posicion})},popup:function(mensaje){}}}angular.module("app").factory("mensajes",mensajes)}(),function(){"use strict";function operacion($http,$rootScope,$q,api,Upload,publicfiles){function creaAtencion(datos){return $http.post(api+"operacion/creaAtencion",datos)}function eliminaImagen(imagen){return $http.post(api+"operacion/eliminaImagen",imagen)}function factura(archivo,folio,etapa,entrega){var promesa=$q.defer(),file=archivo[0];return file.$error?promesa.reject("Formato Invalido"):console.log(file),promesa.promise}function guardaDocumento(datos){return $http.post(api+"operacion/documentos",datos)}function registroPaciente(datos){return $http.post(api+"operacion/registraFolio",datos,{timeout:1e4})}function registroSiniestro(datos){return $http.post(api+"operacion/registraSiniestro",datos,{timeout:1e4})}function solicitaAutorizacion(datos){return $http.post(api+"operacion/autorizacion",datos,{timeout:1e4})}function solicitaCancelacion(datos){return $http.post(api+"operacion/cancelacion",datos,{timeout:1e4})}function subirImagenes(tipo,imagenes,atencion){var promesa=$q.defer(),file=imagenes[0];return file.$error?promesa.reject("Formato Invalido"):Upload.upload({url:api+"operacion/imagenes",data:{file:file,usuario:$rootScope.id,tipo:tipo,atencion:atencion}}).then(function(resp){promesa.resolve(resp.data)},function(resp){isNaN(resp)?promesa.reject("Archivo con problemas"):promesa.reject(resp.data.flash)},function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);promesa.notify(progressPercentage)}),promesa.promise}function ingresaSolicitud(datos){return $http.post(api+"operacion/solicitud",datos,{timeout:1e4})}var operacion={creaAtencion:creaAtencion,eliminaImagen:eliminaImagen,factura:factura,ingresaSolicitud:ingresaSolicitud,guardaDocumento:guardaDocumento,registroPaciente:registroPaciente,registroSiniestro:registroSiniestro,solicitaAutorizacion:solicitaAutorizacion,solicitaCancelacion:solicitaCancelacion,subirImagenes:subirImagenes};return operacion}angular.module("app").factory("operacion",operacion),operacion.$inject=["$http","$rootScope","$q","api","Upload","publicfiles"]}(),function(){"use strict";function registrosGlobales($resource,api){return $resource(api+"busqueda/registrosGlobales",{},{get:{method:"GET",timeout:1e4}})}angular.module("app").factory("registrosGlobales",registrosGlobales)}(),function(){"use strict";function registros($resource,api){return $resource(api+"busqueda/registros",{},{get:{method:"GET",timeout:15e3}})}angular.module("app").factory("registros",registros)}(),function(){"use strict";function reportes($http,$rootScope,api,$q){function atencionesAnio(){return $http.get(api+"reportes/atenciones/anio/"+$rootScope.unidad,{timeout:1e4})}function atencionesMes(){return $http.get(api+"reportes/atenciones/mes/"+$rootScope.unidad,{timeout:1e4})}function detalleEstadistica(tipo){return $http.get(api+"reportes/listado/"+$rootScope.unidad+"/"+tipo,{timeout:1e4})}function estadisticas(){return $http.get(api+"reportes/estadistica/"+$rootScope.unidad,{timeout:1e4})}var servicio={atencionesAnio:atencionesAnio,atencionesMes:atencionesMes,detalleEstadistica:detalleEstadistica,estadisticas:estadisticas};return servicio}angular.module("app").factory("reportes",reportes)}(),function(){"use strict";function usuarios($resource,api){var User=$resource(api+"usuarios/:usuario",{},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},update:{method:"PUT"}});return User}angular.module("app").factory("usuarios",usuarios)}();